<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - trace.lcov_info_final - engine/utf8.cpp</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">engine</a> - utf8.cpp<span style="font-size: 80%;"> (source / <a href="utf8.cpp.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">trace.lcov_info_final</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">87</td>
            <td class="headerCovTableEntry">134</td>
            <td class="headerCovTableEntryLo">64.9 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-10-24</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">12</td>
            <td class="headerCovTableEntry">18</td>
            <td class="headerCovTableEntryLo">66.7 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            :  * The contents of this file are subject to the Mozilla Public
<span class="lineNum">       3 </span>            :  * License Version 1.1 (the &quot;License&quot;); you may not use this file
<span class="lineNum">       4 </span>            :  * except in compliance with the License. You may obtain a copy of
<span class="lineNum">       5 </span>            :  * the License at http://www.mozilla.org/MPL/
<span class="lineNum">       6 </span>            :  *
<span class="lineNum">       7 </span>            :  * Software distributed under the License is distributed on an &quot;AS
<span class="lineNum">       8 </span>            :  * IS&quot; basis, WITHOUT WARRANTY OF ANY KIND, either express or
<span class="lineNum">       9 </span>            :  * implied. See the License for the specific language governing
<span class="lineNum">      10 </span>            :  * rights and limitations under the License.
<span class="lineNum">      11 </span>            :  *
<span class="lineNum">      12 </span>            :  * The Original Code is the Sablotron XSLT Processor.
<span class="lineNum">      13 </span>            :  *
<span class="lineNum">      14 </span>            :  * The Initial Developer of the Original Code is Ginger Alliance Ltd.
<span class="lineNum">      15 </span>            :  * Portions created by Ginger Alliance are Copyright (C) 2000-2002
<span class="lineNum">      16 </span>            :  * Ginger  Alliance Ltd. All Rights Reserved.
<span class="lineNum">      17 </span>            :  *
<span class="lineNum">      18 </span>            :  * Contributor(s): Sven Neumann &lt;neo@netzquadrat.de&gt;,
<span class="lineNum">      19 </span>            :  *                 Marc Lehmann &lt;pcg@goof.com&gt; (character ranges)
<span class="lineNum">      20 </span>            :  *
<span class="lineNum">      21 </span>            :  * Alternatively, the contents of this file may be used under the
<span class="lineNum">      22 </span>            :  * terms of the GNU General Public License Version 2 or later (the
<span class="lineNum">      23 </span>            :  * &quot;GPL&quot;), in which case the provisions of the GPL are applicable
<span class="lineNum">      24 </span>            :  * instead of those above.  If you wish to allow use of your
<span class="lineNum">      25 </span>            :  * version of this file only under the terms of the GPL and not to
<span class="lineNum">      26 </span>            :  * allow others to use your version of this file under the MPL,
<span class="lineNum">      27 </span>            :  * indicate your decision by deleting the provisions above and
<span class="lineNum">      28 </span>            :  * replace them with the notice and other provisions required by
<span class="lineNum">      29 </span>            :  * the GPL.  If you do not delete the provisions above, a recipient
<span class="lineNum">      30 </span>            :  * may use your version of this file under either the MPL or the
<span class="lineNum">      31 </span>            :  * GPL.
<span class="lineNum">      32 </span>            :  */
<span class="lineNum">      33 </span>            : 
<span class="lineNum">      34 </span>            : //
<span class="lineNum">      35 </span>            : //      utf8.cpp
<span class="lineNum">      36 </span>            : //
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span>            : // GP: clean
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span>            : #ifdef HAVE_CONFIG_H
<span class="lineNum">      41 </span>            : #include &lt;config.h&gt;
<span class="lineNum">      42 </span>            : #endif
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            : #include &lt;assert.h&gt;
<span class="lineNum">      45 </span>            : #include &quot;utf8.h&quot;
<span class="lineNum">      46 </span>            : 
<span class="lineNum">      47 </span>            : #if defined(HAVE_WCHAR_H) || defined(_MSC_VER)
<span class="lineNum">      48 </span>            : #include &lt;wchar.h&gt;
<span class="lineNum">      49 </span>            : #endif
<span class="lineNum">      50 </span>            : 
<span class="lineNum">      51 </span>            : /*
<span class="lineNum">      52 </span>            : inline int utf8SingleCharLength (const char* text)
<span class="lineNum">      53 </span>            : {
<span class="lineNum">      54 </span>            :   if (!(*text &amp; 0x80)) return 1;
<span class="lineNum">      55 </span>            :   if (!(*text &amp; 0x40)) return 0;
<span class="lineNum">      56 </span>            :   for (int len = 2; len &lt; 7; len++)
<span class="lineNum">      57 </span>            :       if (!(*text &amp; (0x80 &gt;&gt; len))) return len;
<span class="lineNum">      58 </span>            :   return 0;
<span class="lineNum">      59 </span>            : }
<a name="60"><span class="lineNum">      60 </span>            : */</a>
<span class="lineNum">      61 </span>            : 
<span class="lineNum">      62 </span><span class="lineCov">     606551 : int utf8StrLength (const char* text)</span>
<span class="lineNum">      63 </span>            : {
<span class="lineNum">      64 </span>            :     int len;
<span class="lineNum">      65 </span><span class="lineCov">    6794780 :     for (len = 0; *text; len++)</span>
<span class="lineNum">      66 </span>            :     {
<span class="lineNum">      67 </span><span class="lineCov">    6188229 :         if (!(*text &amp; 0x80))</span>
<span class="lineNum">      68 </span><span class="lineCov">    6025748 :                 text++;</span>
<span class="lineNum">      69 </span><span class="lineCov">     324962 :                 else text += utf8SingleCharLength(text);</span>
<span class="lineNum">      70 </span>            :     }
<span class="lineNum">      71 </span><span class="lineCov">     606551 :     return len;</span>
<a name="72"><span class="lineNum">      72 </span>            : }</a>
<span class="lineNum">      73 </span>            : 
<span class="lineNum">      74 </span><span class="lineCov">     873517 : int utf8Strchr(const char* text, const char* character)</span>
<span class="lineNum">      75 </span>            : {
<span class="lineNum">      76 </span><span class="lineCov">    1747034 :     int len = utf8SingleCharLength(character),</span>
<span class="lineNum">      77 </span><span class="lineCov">     873517 :         pos = 0;</span>
<span class="lineNum">      78 </span><span class="lineCov">   37598861 :     while (*text)</span>
<span class="lineNum">      79 </span>            :     {
<span class="lineNum">      80 </span>            :         // the following works in a prefix encoding
<span class="lineNum">      81 </span><span class="lineCov">   36131795 :         if (!strncmp(text, character, len))</span>
<span class="lineNum">      82 </span>            :                 return pos;
<span class="lineNum">      83 </span><span class="lineCov">   71703654 :                 text += utf8SingleCharLength(text);</span>
<span class="lineNum">      84 </span><span class="lineCov">   35851827 :                 pos++;</span>
<span class="lineNum">      85 </span>            :     }
<span class="lineNum">      86 </span>            :     return -1;
<a name="87"><span class="lineNum">      87 </span>            : }</a>
<span class="lineNum">      88 </span>            : 
<span class="lineNum">      89 </span><span class="lineCov">     279968 : char* utf8StrIndex(char* text, int index)</span>
<span class="lineNum">      90 </span>            : {
<span class="lineNum">      91 </span><span class="lineCov">    1949534 :     for (int i = 0; *text &amp;&amp; (i &lt; index); i++)</span>
<span class="lineNum">      92 </span><span class="lineCov">    3339132 :         text += utf8SingleCharLength(text);</span>
<span class="lineNum">      93 </span><span class="lineCov">     279968 :         return *text ? text : NULL;</span>
<span class="lineNum">      94 </span>            : }
<span class="lineNum">      95 </span>            : 
<span class="lineNum">      96 </span>            : // this ought to return the Unicode equivalent of the UTF-8 char
<a name="97"><span class="lineNum">      97 </span>            : // (for character references like &amp;#22331;)</a>
<span class="lineNum">      98 </span>            : //
<span class="lineNum">      99 </span><span class="lineCov">  124963444 : unsigned long utf8CharCode(const char *text)</span>
<span class="lineNum">     100 </span>            : {
<span class="lineNum">     101 </span><span class="lineCov">  249926888 :     int i, len = utf8SingleCharLength(text);</span>
<span class="lineNum">     102 </span><span class="lineCov">  124963444 :     if (!len) return (unsigned long) -1;</span>
<span class="lineNum">     103 </span><span class="lineCov">  124963444 :     if (len == 1) return *text;</span>
<span class="lineNum">     104 </span><span class="lineCov">    8785719 :     unsigned long code = (*text &amp; (0xff &gt;&gt; (len + 1)));   // get 1st byte</span>
<span class="lineNum">     105 </span><span class="lineCov">   18173440 :     for (i = 1; i &lt; len; i++)</span>
<span class="lineNum">     106 </span><span class="lineCov">    9387721 :         code = (code &lt;&lt; 6) | (text[i] &amp; 0x3f);</span>
<span class="lineNum">     107 </span>            :     return code;
<a name="108"><span class="lineNum">     108 </span>            : }</a>
<span class="lineNum">     109 </span>            : 
<a name="110"><span class="lineNum">     110 </span><span class="lineNoCov">          0 : unsigned long utf16CharCode(const wchar_t *src)</span></a>
<span class="lineNum">     111 </span>            : {
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :     unsigned long first = *src &amp; 0xffffUL; // fix for Solaris</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :     if (first &lt; 0xd800U || first &gt;= 0xe000U)</span>
<span class="lineNum">     114 </span>            :         return first;
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :     unsigned short second = (unsigned short)(src[1]);</span>
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :     unsigned long code = (first - 0xd7c0) &lt;&lt; 10;</span>
<span class="lineNum">     117 </span><span class="lineNoCov">          0 :     code |= (second &amp; ~0xdc00);</span>
<span class="lineNum">     118 </span><span class="lineNoCov">          0 :     return code;</span>
<span class="lineNum">     119 </span>            : }
<a name="120"><span class="lineNum">     120 </span>            : </a>
<span class="lineNum">     121 </span>            : // returns length in *words*
<span class="lineNum">     122 </span><span class="lineNoCov">          0 : int utf16SingleCharLength(const wchar_t *src)</span>
<span class="lineNum">     123 </span>            : {
<span class="lineNum">     124 </span>            :     // issues a warning on win32:
<span class="lineNum">     125 </span>            :     // wchar_t first = *src &amp; 0xffffUL;
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :     unsigned long first = *src &amp; 0xffffUL; // fix for Solaris</span>
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :     if (first &lt; 0xd800U || first &gt;= 0xe000U)</span>
<span class="lineNum">     128 </span>            :         return 1;
<span class="lineNum">     129 </span>            :     else
<span class="lineNum">     130 </span><span class="lineNoCov">          0 :         return 2;</span>
<a name="131"><span class="lineNum">     131 </span>            : }</a>
<span class="lineNum">     132 </span>            : 
<span class="lineNum">     133 </span><span class="lineNoCov">          0 : int utf8FromCharCode(char *dest, unsigned long code)</span>
<span class="lineNum">     134 </span>            : // this is based on Roman Czyborra's description of the algorithm
<span class="lineNum">     135 </span>            : {
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :     char *dest0 = dest;</span>
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :     if (code &lt; 0x80) </span>
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :         *(dest++) = (char)code;</span>
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :     else if (code &lt; 0x800) {</span>
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :         *(dest++) = 0xc0 | (char)(code&gt;&gt;6);</span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :         *(dest++) = 0x80 | (char)code &amp; 0x3f;</span>
<span class="lineNum">     142 </span>            :     }
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :     else if (code &lt; 0x10000UL) {</span>
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :         *(dest++) = 0xe0 | (char)(code&gt;&gt;12);</span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :         *(dest++) = 0x80 | (char)(code&gt;&gt;6) &amp; 0x3f;</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :         *(dest++) = 0x80 | (char)code &amp; 0x3f;</span>
<span class="lineNum">     147 </span>            :     }
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :     else if (code &lt; 0x200000UL) {</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :         *(dest++) = 0xf0 | (char)(code&gt;&gt;18);</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :         *(dest++) = 0x80 | (char)(code&gt;&gt;12) &amp; 0x3f;</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :         *(dest++) = 0x80 | (char)(code&gt;&gt;6) &amp; 0x3f;</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :         *(dest++) = 0x80 | (char)code &amp; 0x3f;</span>
<span class="lineNum">     153 </span>            :     };
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :     return (dest - dest0);</span>
<span class="lineNum">     155 </span>            : }
<span class="lineNum">     156 </span>            : 
<a name="157"><span class="lineNum">     157 </span>            : // returns length of the result *in words*</a>
<span class="lineNum">     158 </span>            : 
<span class="lineNum">     159 </span><span class="lineCov">     124609 : int utf8ToUtf16(wchar_t *dest, const char *src)</span>
<span class="lineNum">     160 </span>            : {
<span class="lineNum">     161 </span>            :     unsigned long code;
<span class="lineNum">     162 </span><span class="lineCov">     124609 :     int len = 0,</span>
<span class="lineNum">     163 </span>            :         thislen;
<span class="lineNum">     164 </span><span class="lineCov">    1805983 :     for (const char *p = src; *p; p += utf8SingleCharLength(p))</span>
<span class="lineNum">     165 </span>            :     {
<span class="lineNum">     166 </span><span class="lineCov">     840687 :         code = utf8CharCode(p);</span>
<span class="lineNum">     167 </span><span class="lineCov">     840687 :         if (code &lt; 0x10000UL)</span>
<span class="lineNum">     168 </span>            :         {
<span class="lineNum">     169 </span><span class="lineCov">     840684 :             *dest = (wchar_t)(code);</span>
<span class="lineNum">     170 </span><span class="lineCov">     840684 :             thislen = 1;</span>
<span class="lineNum">     171 </span>            :         }
<span class="lineNum">     172 </span>            :         else
<span class="lineNum">     173 </span>            :         {
<span class="lineNum">     174 </span><span class="lineCov">          3 :             dest[0] = 0xd7c0U + (code &gt;&gt; 10);</span>
<span class="lineNum">     175 </span><span class="lineCov">          3 :             dest[1] = 0xdc00U | code &amp; 0x3ff;</span>
<span class="lineNum">     176 </span><span class="lineCov">          3 :             thislen = 2;</span>
<span class="lineNum">     177 </span>            :         };
<span class="lineNum">     178 </span><span class="lineCov">     840687 :         dest += thislen;</span>
<span class="lineNum">     179 </span><span class="lineCov">     840687 :         len += thislen;</span>
<span class="lineNum">     180 </span>            :     }
<span class="lineNum">     181 </span><span class="lineCov">     124609 :     *dest = 0;</span>
<span class="lineNum">     182 </span><span class="lineCov">     124609 :     return len;</span>
<span class="lineNum">     183 </span>            : }
<span class="lineNum">     184 </span>            : 
<span class="lineNum">     185 </span><span class="lineNoCov">          0 : int utf8FromUtf16(char *dest, const wchar_t *src)</span>
<span class="lineNum">     186 </span>            : {
<span class="lineNum">     187 </span>            :     unsigned long code;
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :     int len = 0, thislen;</span>
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :     for (;*src;)</span>
<span class="lineNum">     190 </span>            :     {
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :         code = utf16CharCode(src);</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :         src += utf16SingleCharLength(src);</span>
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :         thislen = utf8FromCharCode(dest, code);</span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :         len += thislen;</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :         dest += thislen;</span>
<span class="lineNum">     196 </span>            :     }
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :     *dest = 0;</span>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :     return len;</span>
<span class="lineNum">     199 </span>            : }
<span class="lineNum">     200 </span>            : 
<span class="lineNum">     201 </span>            : 
<span class="lineNum">     202 </span>            : // this does the same as strcoll for utf8 strings
<span class="lineNum">     203 </span>            : /*
<span class="lineNum">     204 </span>            : Str utf8xfrm(const Str &amp;src)
<span class="lineNum">     205 </span>            : {
<span class="lineNum">     206 </span>            : #   if !defined(HAVE_WCSXFRM) &amp;&amp; !defined(_MSC_VER)
<span class="lineNum">     207 </span>            :     // empty if no wcsxfrm()
<span class="lineNum">     208 </span>            :     return (char*)&quot;&quot;;
<span class="lineNum">     209 </span>            : #   else
<span class="lineNum">     210 </span>            :     int wideReserved = src.length() + 1, // *words*
<span class="lineNum">     211 </span>            :         transReserved;
<span class="lineNum">     212 </span>            :     wchar_t *wide = new wchar_t[wideReserved];
<span class="lineNum">     213 </span>            :     utf8ToUtf16(wide, src);
<span class="lineNum">     214 </span>            :     // sadly, this doesn't work in MSVC 6.0
<span class="lineNum">     215 </span>            :     // looks like there's a bug in MS's wcsxfrm.c:
<span class="lineNum">     216 </span>            : 
<span class="lineNum">     217 </span>            :     // transReserved = 1 + wcsxfrm( NULL, wide, 0 );
<span class="lineNum">     218 </span>            :     // wchar_t *transformed = new wchar_t[transReserved];
<span class="lineNum">     219 </span>            : 
<span class="lineNum">     220 </span>            :     // FIXME: this is wild. when fixing, be sure to free 'transformed' at the end 
<span class="lineNum">     221 </span>            :     transReserved = 1024;
<span class="lineNum">     222 </span>            :     wchar_t transformed[1024];
<span class="lineNum">     223 </span>            : 
<span class="lineNum">     224 </span>            :     int transLen = wcsxfrm(transformed, wide, transReserved);
<span class="lineNum">     225 </span>            :     sabassert(transReserved &gt;= transLen + 1);
<span class="lineNum">     226 </span>            :     
<span class="lineNum">     227 </span>            : #   if defined(SABLOT_WCSXFRM_SWAP)
<span class="lineNum">     228 </span>            :     // the implementation of wcsxfrm on Solaris systems requires us
<span class="lineNum">     229 </span>            :     // to swap the words in the 4-byte wchar_t. This was found by Steve Rowe.
<span class="lineNum">     230 </span>            :     wchar_t *p = transformed;
<span class="lineNum">     231 </span>            :     for (int i = 0; i &lt; transLen; i++, p++)
<span class="lineNum">     232 </span>            :     {
<span class="lineNum">     233 </span>            :         // swap words in transformed[i]
<span class="lineNum">     234 </span>            :             *p = (*p &gt;&gt; 16) | ((*p &amp; 0xffffUL) &lt;&lt; 16);
<span class="lineNum">     235 </span>            :     }
<span class="lineNum">     236 </span>            : #   endif
<span class="lineNum">     237 </span>            :     
<span class="lineNum">     238 </span>            :     // FIXME: better estimate?
<span class="lineNum">     239 </span>            :     int resultReserved = (transLen &lt;&lt; 3) + 1;
<span class="lineNum">     240 </span>            :     char *result = new char[resultReserved];
<span class="lineNum">     241 </span>            :     int resultLen = utf8FromUtf16(result, transformed);
<span class="lineNum">     242 </span>            :     sabassert (resultLen &lt; resultReserved);
<span class="lineNum">     243 </span>            :     Str resultStr = result;
<span class="lineNum">     244 </span>            :     delete[] wide;
<span class="lineNum">     245 </span>            :     // delete[] transformed; - temporarily allocating on the stack
<span class="lineNum">     246 </span>            :     delete[] result;
<span class="lineNum">     247 </span>            :     return resultStr;
<span class="lineNum">     248 </span>            : #   endif // no wcsxfrm
<span class="lineNum">     249 </span>            : }
<span class="lineNum">     250 </span>            : */
<a name="251"><span class="lineNum">     251 </span>            : </a>
<span class="lineNum">     252 </span>            : //returns pointer to char due CList values typing
<span class="lineNum">     253 </span><span class="lineCov">       3292 : char* utf8xfrm(const Str &amp;src)</span>
<span class="lineNum">     254 </span>            : {
<span class="lineNum">     255 </span>            : #   if !defined(SAB_WCS_COLLATE)
<span class="lineNum">     256 </span>            :     // empty if no wcsxfrm()
<span class="lineNum">     257 </span>            :     return (char*)&quot;&quot;;
<span class="lineNum">     258 </span>            : #   else
<span class="lineNum">     259 </span><span class="lineCov">       3292 :     int wideReserved = src.length() + 1, // *words*</span>
<span class="lineNum">     260 </span>            :         transReserved;
<span class="lineNum">     261 </span><span class="lineCov">       3292 :     wchar_t *wide = new wchar_t[wideReserved];</span>
<span class="lineNum">     262 </span><span class="lineCov">       3292 :     utf8ToUtf16(wide, src);</span>
<span class="lineNum">     263 </span>            : 
<span class="lineNum">     264 </span><span class="lineCov">       3292 :     transReserved = wideReserved * 3 / 2; //naive estimation</span>
<span class="lineNum">     265 </span><span class="lineCov">       3292 :     char *transformed = new char[transReserved * sizeof(wchar_t)];</span>
<span class="lineNum">     266 </span>            : 
<span class="lineNum">     267 </span><span class="lineCov">       3292 :     int transLen = wcsxfrm((wchar_t*)transformed, wide, transReserved);</span>
<span class="lineNum">     268 </span><span class="lineCov">       6584 :     while (transReserved &lt; transLen + 1)</span>
<span class="lineNum">     269 </span>            :       {
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :         delete[] transformed;</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :         transReserved = (transReserved &gt; 1 ? transReserved : 2) * 3 / 2; //some reallocation</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :         transformed = new char[transReserved * sizeof(wchar_t)];</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :         transLen = wcsxfrm((wchar_t*)transformed, wide, transReserved);</span>
<span class="lineNum">     274 </span>            :       }
<span class="lineNum">     275 </span>            :     
<span class="lineNum">     276 </span>            :     // FIXME: better estimate?
<span class="lineNum">     277 </span><span class="lineCov">       3292 :     delete[] wide;</span>
<span class="lineNum">     278 </span><span class="lineCov">       3292 :     return transformed;</span>
<span class="lineNum">     279 </span>            : #   endif // no wcsxfrm
<a name="280"><span class="lineNum">     280 </span>            : }</a>
<span class="lineNum">     281 </span>            : 
<span class="lineNum">     282 </span><span class="lineNoCov">          0 : int utf8GetChar(char *dest, const char *src)</span>
<span class="lineNum">     283 </span>            : {
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :     int len = utf8SingleCharLength (src);</span>
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :     memcpy (dest, src, len);</span>
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :     return len;</span>
<span class="lineNum">     287 </span>            : }
<span class="lineNum">     288 </span>            : 
<span class="lineNum">     289 </span>            : 
<span class="lineNum">     290 </span>            : // tests whether a character in &quot;c&quot; is Within Range
<a name="291"><span class="lineNum">     291 </span>            : #define wr(a,b) (((c) - (a)) &lt;= (b) - (a))</a>
<span class="lineNum">     292 </span>            : 
<span class="lineNum">     293 </span><span class="lineCov">   59338876 : Bool utf8IsDigit(unsigned long c)</span>
<span class="lineNum">     294 </span>            : {
<span class="lineNum">     295 </span>            :    return
<span class="lineNum">     296 </span><span class="lineCov">  112245001 :       wr(0x0030,0x0039) || wr(0x0660,0x0669) || wr(0x06F0,0x06F9) || wr(0x0966,0x096F) || wr(0x09E6,0x09EF) || wr(0x0A66,0x0A6F) || wr(0x0AE6,0x0AEF) || wr(0x0B66,0x0B6F) || wr(0x0BE7,0x0BEF) || wr(0x0C66,0x0C6F) || wr(0x0CE6,0x0CEF)</span>
<span class="lineNum">     297 </span><span class="lineCov">  112236699 :       || wr(0x0D66,0x0D6F) || wr(0x0E50,0x0E59) || wr(0x0ED0,0x0ED9) || wr(0x0F20,0x0F29);</span>
<a name="298"><span class="lineNum">     298 </span>            : }</a>
<span class="lineNum">     299 </span>            : 
<span class="lineNum">     300 </span><span class="lineCov">  110715742 : Bool utf8IsBaseChar(unsigned long c)</span>
<span class="lineNum">     301 </span>            : {
<span class="lineNum">     302 </span>            :    return
<span class="lineNum">     303 </span><span class="lineCov">  137667683 :       wr(0x0041,0x005A) || wr(0x0061,0x007A) || wr(0x00C0,0x00D6) || wr(0x00D8,0x00F6) || wr(0x00F8,0x00FF) || wr(0x0100,0x0131) || wr(0x0134,0x013E) || wr(0x0141,0x0148) || wr(0x014A,0x017E) || wr(0x0180,0x01C3) || wr(0x01CD,0x01F0)</span>
<span class="lineNum">     304 </span><span class="lineCov">   26116232 :       || wr(0x01F4,0x01F5) || wr(0x01FA,0x0217) || wr(0x0250,0x02A8) || wr(0x02BB,0x02C1) || c == 0x0386 || wr(0x0388,0x038A) || c == 0x038C || wr(0x038E,0x03A1) || wr(0x03A3,0x03CE) || wr(0x03D0,0x03D6) || c == 0x03DA || c == 0x03DC || c == 0x03DE</span>
<span class="lineNum">     305 </span><span class="lineCov">   25563885 :       || c == 0x03E0 || wr(0x03E2,0x03F3) || wr(0x0401,0x040C) || wr(0x040E,0x044F) || wr(0x0451,0x045C) || wr(0x045E,0x0481) || wr(0x0490,0x04C4) || wr(0x04C7,0x04C8) || wr(0x04CB,0x04CC) || wr(0x04D0,0x04EB) || wr(0x04EE,0x04F5)</span>
<span class="lineNum">     306 </span><span class="lineCov">   21012744 :       || wr(0x04F8,0x04F9) || wr(0x0531,0x0556) || c == 0x0559 || wr(0x0561,0x0586) || wr(0x05D0,0x05EA) || wr(0x05F0,0x05F2) || wr(0x0621,0x063A) || wr(0x0641,0x064A) || wr(0x0671,0x06B7) || wr(0x06BA,0x06BE) || wr(0x06C0,0x06CE)</span>
<span class="lineNum">     307 </span><span class="lineCov">   20199748 :       || wr(0x06D0,0x06D3) || c == 0x06D5 || wr(0x06E5,0x06E6) || wr(0x0905,0x0939) || c == 0x093D || wr(0x0958,0x0961) || wr(0x0985,0x098C) || wr(0x098F,0x0990) || wr(0x0993,0x09A8) || wr(0x09AA,0x09B0) || c == 0x09B2 || wr(0x09B6,0x09B9)</span>
<span class="lineNum">     308 </span><span class="lineCov">   20154253 :       || wr(0x09DC,0x09DD) || wr(0x09DF,0x09E1) || wr(0x09F0,0x09F1) || wr(0x0A05,0x0A0A) || wr(0x0A0F,0x0A10) || wr(0x0A13,0x0A28) || wr(0x0A2A,0x0A30) || wr(0x0A32,0x0A33) || wr(0x0A35,0x0A36) || wr(0x0A38,0x0A39)</span>
<span class="lineNum">     309 </span><span class="lineCov">   20129146 :       || wr(0x0A59,0x0A5C) || c == 0x0A5E || wr(0x0A72,0x0A74) || wr(0x0A85,0x0A8B) || c == 0x0A8D || wr(0x0A8F,0x0A91) || wr(0x0A93,0x0AA8) || wr(0x0AAA,0x0AB0) || wr(0x0AB2,0x0AB3) || wr(0x0AB5,0x0AB9) || c == 0x0ABD || c == 0x0AE0</span>
<span class="lineNum">     310 </span><span class="lineCov">   20103528 :       || wr(0x0B05,0x0B0C) || wr(0x0B0F,0x0B10) || wr(0x0B13,0x0B28) || wr(0x0B2A,0x0B30) || wr(0x0B32,0x0B33) || wr(0x0B36,0x0B39) || c == 0x0B3D || wr(0x0B5C,0x0B5D) || wr(0x0B5F,0x0B61) || wr(0x0B85,0x0B8A) || wr(0x0B8E,0x0B90)</span>
<span class="lineNum">     311 </span><span class="lineCov">   20098050 :       || wr(0x0B92,0x0B95) || wr(0x0B99,0x0B9A) || c == 0x0B9C || wr(0x0B9E,0x0B9F) || wr(0x0BA3,0x0BA4) || wr(0x0BA8,0x0BAA) || wr(0x0BAE,0x0BB5) || wr(0x0BB7,0x0BB9) || wr(0x0C05,0x0C0C) || wr(0x0C0E,0x0C10) || wr(0x0C12,0x0C28)</span>
<span class="lineNum">     312 </span><span class="lineCov">   20059107 :       || wr(0x0C2A,0x0C33) || wr(0x0C35,0x0C39) || wr(0x0C60,0x0C61) || wr(0x0C85,0x0C8C) || wr(0x0C8E,0x0C90) || wr(0x0C92,0x0CA8) || wr(0x0CAA,0x0CB3) || wr(0x0CB5,0x0CB9) || c == 0x0CDE || wr(0x0CE0,0x0CE1) || wr(0x0D05,0x0D0C)</span>
<span class="lineNum">     313 </span><span class="lineCov">   20036750 :       || wr(0x0D0E,0x0D10) || wr(0x0D12,0x0D28) || wr(0x0D2A,0x0D39) || wr(0x0D60,0x0D61) || wr(0x0E01,0x0E2E) || c == 0x0E30 || wr(0x0E32,0x0E33) || wr(0x0E40,0x0E45) || wr(0x0E81,0x0E82) || c == 0x0E84 || wr(0x0E87,0x0E88) || c == 0x0E8A</span>
<span class="lineNum">     314 </span><span class="lineCov">   19923286 :       || c == 0x0E8D || wr(0x0E94,0x0E97) || wr(0x0E99,0x0E9F) || wr(0x0EA1,0x0EA3) || c == 0x0EA5 || c == 0x0EA7 || wr(0x0EAA,0x0EAB) || wr(0x0EAD,0x0EAE) || c == 0x0EB0 || wr(0x0EB2,0x0EB3) || c == 0x0EBD || wr(0x0EC0,0x0EC4) || wr(0x0F40,0x0F47)</span>
<span class="lineNum">     315 </span><span class="lineCov">   19882311 :       || wr(0x0F49,0x0F69) || wr(0x10A0,0x10C5) || wr(0x10D0,0x10F6) || c == 0x1100 || wr(0x1102,0x1103) || wr(0x1105,0x1107) || c == 0x1109 || wr(0x110B,0x110C) || wr(0x110E,0x1112) || c == 0x113C || c == 0x113E || c == 0x1140 || c == 0x114C || c == 0x114E</span>
<span class="lineNum">     316 </span><span class="lineCov">   19844029 :       || c == 0x1150 || wr(0x1154,0x1155) || c == 0x1159 || wr(0x115F,0x1161) || c == 0x1163 || c == 0x1165 || c == 0x1167 || c == 0x1169 || wr(0x116D,0x116E) || wr(0x1172,0x1173) || c == 0x1175 || c == 0x119E || c == 0x11A8 || c == 0x11AB || wr(0x11AE,0x11AF)</span>
<span class="lineNum">     317 </span><span class="lineCov">   19825060 :       || wr(0x11B7,0x11B8) || c == 0x11BA || wr(0x11BC,0x11C2) || c == 0x11EB || c == 0x11F0 || c == 0x11F9 || wr(0x1E00,0x1E9B) || wr(0x1EA0,0x1EF9) || wr(0x1F00,0x1F15) || wr(0x1F18,0x1F1D) || wr(0x1F20,0x1F45) || wr(0x1F48,0x1F4D)</span>
<span class="lineNum">     318 </span><span class="lineCov">   19809292 :       || wr(0x1F50,0x1F57) || c == 0x1F59 || c == 0x1F5B || c == 0x1F5D || wr(0x1F5F,0x1F7D) || wr(0x1F80,0x1FB4) || wr(0x1FB6,0x1FBC) || c == 0x1FBE || wr(0x1FC2,0x1FC4) || wr(0x1FC6,0x1FCC) || wr(0x1FD0,0x1FD3) || wr(0x1FD6,0x1FDB)</span>
<span class="lineNum">     319 </span><span class="lineCov">  130516608 :       || wr(0x1FE0,0x1FEC) || wr(0x1FF2,0x1FF4) || wr(0x1FF6,0x1FFC) || c == 0x2126 || wr(0x212A,0x212B) || c == 0x212E || wr(0x2180,0x2182) || wr(0x3041,0x3094) || wr(0x30A1,0x30FA) || wr(0x3105,0x312C) || wr(0xAC00,0xD7A3);</span>
<a name="320"><span class="lineNum">     320 </span>            : }</a>
<span class="lineNum">     321 </span>            : 
<span class="lineNum">     322 </span><span class="lineNoCov">          0 : Bool utf8IsIdeographic(unsigned long c)</span>
<a name="323"><span class="lineNum">     323 </span>            : {</a>
<span class="lineNum">     324 </span>            :    return
<span class="lineNum">     325 </span><span class="lineCov">   19763315 :       wr(0x4E00,0x9FA5) || c == 0x3007 || wr(0x3021,0x3029);</span>
<a name="326"><span class="lineNum">     326 </span>            : }</a>
<span class="lineNum">     327 </span>            : 
<span class="lineNum">     328 </span><span class="lineCov">    6254472 : Bool utf8IsExtender(unsigned long c)</span>
<span class="lineNum">     329 </span>            : {
<span class="lineNum">     330 </span>            :    return
<span class="lineNum">     331 </span><span class="lineCov">    6254472 :       c == 0x00B7 || c == 0x02D0 || c == 0x02D1 || c == 0x0387 || c == 0x0640 || c == 0x0E46 || c == 0x0EC6 || c == 0x3005 || wr(0x3031,0x3035) || wr(0x309D,0x309E) || wr(0x30FC,0x30FE);</span>
<a name="332"><span class="lineNum">     332 </span>            : }</a>
<span class="lineNum">     333 </span>            : 
<span class="lineNum">     334 </span><span class="lineCov">    6395218 : Bool utf8IsCombiningChar(unsigned long c)</span>
<span class="lineNum">     335 </span>            : {
<span class="lineNum">     336 </span>            :    return
<span class="lineNum">     337 </span><span class="lineCov">   12786258 :       wr(0x0300,0x0345) || wr(0x0360,0x0361) || wr(0x0483,0x0486) || wr(0x0591,0x05A1) || wr(0x05A3,0x05B9) || wr(0x05BB,0x05BD) || c == 0x05BF || wr(0x05C1,0x05C2) || c == 0x05C4 || wr(0x064B,0x0652) || c == 0x0670 || wr(0x06D6,0x06DC)</span>
<span class="lineNum">     338 </span><span class="lineCov">    6305528 :       || wr(0x06DD,0x06DF) || wr(0x06E0,0x06E4) || wr(0x06E7,0x06E8) || wr(0x06EA,0x06ED) || wr(0x0901,0x0903) || c == 0x093C || wr(0x093E,0x094C) || c == 0x094D || wr(0x0951,0x0954) || wr(0x0962,0x0963) || wr(0x0981,0x0983) || c == 0x09BC</span>
<span class="lineNum">     339 </span><span class="lineCov">    6291730 :       || c == 0x09BE || c == 0x09BF || wr(0x09C0,0x09C4) || wr(0x09C7,0x09C8) || wr(0x09CB,0x09CD) || c == 0x09D7 || wr(0x09E2,0x09E3) || c == 0x0A02 || c == 0x0A3C || c == 0x0A3E || c == 0x0A3F || wr(0x0A40,0x0A42) || wr(0x0A47,0x0A48) || wr(0x0A4B,0x0A4D)</span>
<span class="lineNum">     340 </span><span class="lineCov">    6290473 :       || wr(0x0A70,0x0A71) || wr(0x0A81,0x0A83) || c == 0x0ABC || wr(0x0ABE,0x0AC5) || wr(0x0AC7,0x0AC9) || wr(0x0ACB,0x0ACD) || wr(0x0B01,0x0B03) || c == 0x0B3C || wr(0x0B3E,0x0B43) || wr(0x0B47,0x0B48) || wr(0x0B4B,0x0B4D)</span>
<span class="lineNum">     341 </span><span class="lineCov">    6283147 :       || wr(0x0B56,0x0B57) || wr(0x0B82,0x0B83) || wr(0x0BBE,0x0BC2) || wr(0x0BC6,0x0BC8) || wr(0x0BCA,0x0BCD) || c == 0x0BD7 || wr(0x0C01,0x0C03) || wr(0x0C3E,0x0C44) || wr(0x0C46,0x0C48) || wr(0x0C4A,0x0C4D) || wr(0x0C55,0x0C56)</span>
<span class="lineNum">     342 </span><span class="lineCov">    6279087 :       || wr(0x0C82,0x0C83) || wr(0x0CBE,0x0CC4) || wr(0x0CC6,0x0CC8) || wr(0x0CCA,0x0CCD) || wr(0x0CD5,0x0CD6) || wr(0x0D02,0x0D03) || wr(0x0D3E,0x0D43) || wr(0x0D46,0x0D48) || wr(0x0D4A,0x0D4D) || c == 0x0D57 || c == 0x0E31</span>
<span class="lineNum">     343 </span><span class="lineCov">    6267640 :       || wr(0x0E34,0x0E3A) || wr(0x0E47,0x0E4E) || c == 0x0EB1 || wr(0x0EB4,0x0EB9) || wr(0x0EBB,0x0EBC) || wr(0x0EC8,0x0ECD) || wr(0x0F18,0x0F19) || c == 0x0F35 || c == 0x0F37 || c == 0x0F39 || c == 0x0F3E || c == 0x0F3F || wr(0x0F71,0x0F84)</span>
<span class="lineNum">     344 </span><span class="lineCov">   12655652 :       || wr(0x0F86,0x0F8B) || wr(0x0F90,0x0F95) || c == 0x0F97 || wr(0x0F99,0x0FAD) || wr(0x0FB1,0x0FB7) || c == 0x0FB9 || wr(0x20D0,0x20DC) || c == 0x20E1 || wr(0x302A,0x302F) || c == 0x3099 || c == 0x309A;</span>
<span class="lineNum">     345 </span>            : }
<span class="lineNum">     346 </span>            : 
<span class="lineNum">     347 </span><span class="lineCov">  110715742 : Bool utf8IsLetter(unsigned long c)</span>
<span class="lineNum">     348 </span>            : {
<span class="lineNum">     349 </span><span class="lineCov">  130479057 :    return utf8IsBaseChar(c) || utf8IsIdeographic(c);</span>
<a name="350"><span class="lineNum">     350 </span>            : }</a>
<span class="lineNum">     351 </span>            : 
<span class="lineNum">     352 </span><span class="lineCov">   59717207 : Bool utf8IsNameChar(unsigned long c)</span>
<span class="lineNum">     353 </span>            : {
<span class="lineNum">     354 </span><span class="lineCov">   68736257 :    return utf8IsLetter(c) || utf8IsDigit(c)</span>
<span class="lineNum">     355 </span><span class="lineCov">    8698966 :           || c == '.' || c == '-' ||  c =='_' ||  c ==':'</span>
<span class="lineNum">     356 </span><span class="lineCov">   66013129 :           || utf8IsCombiningChar(c) || utf8IsExtender(c);</span>
<span class="lineNum">     357 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
