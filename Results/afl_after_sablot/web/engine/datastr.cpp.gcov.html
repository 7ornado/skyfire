<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - trace.lcov_info_final - engine/datastr.cpp</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">engine</a> - datastr.cpp<span style="font-size: 80%;"> (source / <a href="datastr.cpp.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">trace.lcov_info_final</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">327</td>
            <td class="headerCovTableEntry">465</td>
            <td class="headerCovTableEntryLo">70.3 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-10-21</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">77</td>
            <td class="headerCovTableEntry">111</td>
            <td class="headerCovTableEntryLo">69.4 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* </a>
<span class="lineNum">       2 </span>            :  * The contents of this file are subject to the Mozilla Public
<span class="lineNum">       3 </span>            :  * License Version 1.1 (the &quot;License&quot;); you may not use this file
<span class="lineNum">       4 </span>            :  * except in compliance with the License. You may obtain a copy of
<span class="lineNum">       5 </span>            :  * the License at http://www.mozilla.org/MPL/
<span class="lineNum">       6 </span>            :  * 
<span class="lineNum">       7 </span>            :  * Software distributed under the License is distributed on an &quot;AS
<span class="lineNum">       8 </span>            :  * IS&quot; basis, WITHOUT WARRANTY OF ANY KIND, either express or
<span class="lineNum">       9 </span>            :  * implied. See the License for the specific language governing
<span class="lineNum">      10 </span>            :  * rights and limitations under the License.
<span class="lineNum">      11 </span>            :  * 
<span class="lineNum">      12 </span>            :  * The Original Code is the Sablotron XSLT Processor.
<span class="lineNum">      13 </span>            :  * 
<span class="lineNum">      14 </span>            :  * The Initial Developer of the Original Code is Ginger Alliance Ltd.
<span class="lineNum">      15 </span>            :  * Portions created by Ginger Alliance are Copyright (C) 2000-2002
<span class="lineNum">      16 </span>            :  * Ginger Alliance Ltd. All Rights Reserved.
<span class="lineNum">      17 </span>            :  * 
<span class="lineNum">      18 </span>            :  * Contributor(s):
<span class="lineNum">      19 </span>            :  * 
<span class="lineNum">      20 </span>            :  * Alternatively, the contents of this file may be used under the
<span class="lineNum">      21 </span>            :  * terms of the GNU General Public License Version 2 or later (the
<span class="lineNum">      22 </span>            :  * &quot;GPL&quot;), in which case the provisions of the GPL are applicable 
<span class="lineNum">      23 </span>            :  * instead of those above.  If you wish to allow use of your 
<span class="lineNum">      24 </span>            :  * version of this file only under the terms of the GPL and not to
<span class="lineNum">      25 </span>            :  * allow others to use your version of this file under the MPL,
<span class="lineNum">      26 </span>            :  * indicate your decision by deleting the provisions above and
<span class="lineNum">      27 </span>            :  * replace them with the notice and other provisions required by
<span class="lineNum">      28 </span>            :  * the GPL.  If you do not delete the provisions above, a recipient
<span class="lineNum">      29 </span>            :  * may use your version of this file under either the MPL or the
<span class="lineNum">      30 </span>            :  * GPL.
<span class="lineNum">      31 </span>            :  */
<span class="lineNum">      32 </span>            : 
<span class="lineNum">      33 </span>            : #include &quot;datastr.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;verts.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;utf8.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;tree.h&quot;
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span>            : // GP: clean (only 1 eFlag routine)
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span>            : // #include &lt;malloc.h&gt; - not needed and deprecated anyway
<span class="lineNum">      41 </span>            : 
<span class="lineNum">      42 </span>            : /* const Str* theEmptyString = new Str(&quot;&quot;); */
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            : //     implementations for List are in datastr.h (List is a template)
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            : 
<span class="lineNum">      47 </span>            : /*****************************************************************
<span class="lineNum">      48 </span>            : DynBlock
<span class="lineNum">      49 </span>            : 
<span class="lineNum">      50 </span>            :   is a class for &quot;dynamic memory blocks&quot;, i.e. blocks that can 
<span class="lineNum">      51 </span>            :   grow in size.
<a name="52"><span class="lineNum">      52 </span>            : *****************************************************************/</a>
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span><span class="lineNoCov">          0 : DynBlock::DynBlock()</span>
<span class="lineNum">      55 </span>            : {
<span class="lineNum">      56 </span><span class="lineCov">     373895 :     first = last = NULL;</span>
<span class="lineNum">      57 </span><span class="lineCov">     373895 :     byteCount = 0;</span>
<a name="58"><span class="lineNum">      58 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      59 </span>            : 
<span class="lineNum">      60 </span><span class="lineCov">    1712407 : inline void DynBlock::remove()</span>
<span class="lineNum">      61 </span>            : {
<span class="lineNum">      62 </span>            :     DynBlockItem *d, *d_was;
<span class="lineNum">      63 </span><span class="lineCov">    1712407 :     if (first)</span>
<span class="lineNum">      64 </span>            :     {
<span class="lineNum">      65 </span><span class="lineCov">     109876 :         for (d = first; d; )</span>
<span class="lineNum">      66 </span>            :         {
<span class="lineNum">      67 </span><span class="lineCov">      58252 :             d_was = d;</span>
<span class="lineNum">      68 </span><span class="lineCov">      58252 :             d = d_was -&gt; next;</span>
<span class="lineNum">      69 </span><span class="lineCov">      58252 :             delete [] d_was -&gt; data;</span>
<span class="lineNum">      70 </span><span class="lineCov">      58252 :             delete d_was;</span>
<span class="lineNum">      71 </span>            :         }
<span class="lineNum">      72 </span>            :     };
<span class="lineNum">      73 </span><span class="lineCov">    1712407 :     first = last = NULL;</span>
<span class="lineNum">      74 </span><span class="lineCov">    1712407 :     byteCount = 0;</span>
<a name="75"><span class="lineNum">      75 </span><span class="lineCov">    1712407 : }</span></a>
<span class="lineNum">      76 </span>            : 
<span class="lineNum">      77 </span><span class="lineNoCov">          0 : DynBlock::~DynBlock()</span>
<span class="lineNum">      78 </span>            : {
<span class="lineNum">      79 </span><span class="lineCov">     373895 :     remove();</span>
<a name="80"><span class="lineNum">      80 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      81 </span>            : 
<span class="lineNum">      82 </span><span class="lineNoCov">          0 : inline Bool DynBlock::isEmpty() const</span>
<span class="lineNum">      83 </span>            : {
<span class="lineNum">      84 </span><span class="lineNoCov">          0 :     return !byteCount;</span>
<a name="85"><span class="lineNum">      85 </span>            : }</a>
<span class="lineNum">      86 </span>            : 
<span class="lineNum">      87 </span><span class="lineCov">     466099 : void DynBlock::nadd(const char *data, int bytes)</span>
<span class="lineNum">      88 </span>            : {
<span class="lineNum">      89 </span><span class="lineCov">     466099 :     DynBlockItem *newitem = new DynBlockItem;</span>
<span class="lineNum">      90 </span><span class="lineCov">     466099 :     newitem -&gt; data = new char[bytes];</span>
<span class="lineNum">      91 </span><span class="lineCov">     466099 :     memcpy(newitem -&gt; data, data, bytes);</span>
<span class="lineNum">      92 </span><span class="lineCov">     466099 :     newitem -&gt; byteCount = bytes;</span>
<span class="lineNum">      93 </span><span class="lineCov">     466099 :     newitem -&gt; next = NULL;</span>
<span class="lineNum">      94 </span><span class="lineCov">     466099 :     if (last)</span>
<span class="lineNum">      95 </span><span class="lineCov">     187011 :         last -&gt; next = newitem;</span>
<span class="lineNum">      96 </span>            :     else
<span class="lineNum">      97 </span><span class="lineCov">     279088 :         first = newitem;</span>
<span class="lineNum">      98 </span><span class="lineCov">     466099 :     last = newitem;</span>
<span class="lineNum">      99 </span><span class="lineCov">     466099 :     byteCount += bytes;</span>
<a name="100"><span class="lineNum">     100 </span><span class="lineCov">     466099 : }</span></a>
<span class="lineNum">     101 </span>            : 
<span class="lineNum">     102 </span><span class="lineNoCov">          0 : char* DynBlock::getPointer() const</span>
<span class="lineNum">     103 </span>            : {
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :     if (!first)</span>
<span class="lineNum">     105 </span>            :         return NULL;
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :     if (first -&gt; next)</span>
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :         compact();</span>
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :     return (first -&gt; data);</span>
<span class="lineNum">     109 </span>            : }
<span class="lineNum">     110 </span>            : 
<span class="lineNum">     111 </span>            : // compactToBuffer() joins the parts in a buffer. Returns buf+byteCount.
<a name="112"><span class="lineNum">     112 </span>            : // if kill_ then the parts will be deallocated</a>
<span class="lineNum">     113 </span>            : 
<span class="lineNum">     114 </span><span class="lineCov">     227464 : int DynBlock::compactToBuffer_(char* buf, Bool kill_)</span>
<span class="lineNum">     115 </span>            : {
<span class="lineNum">     116 </span><span class="lineCov">     227464 :     int compactedBytes = 0;</span>
<span class="lineNum">     117 </span><span class="lineCov">     227464 :     char *p = buf;</span>
<span class="lineNum">     118 </span><span class="lineCov">     227464 :     if (first)</span>
<span class="lineNum">     119 </span>            :     {
<span class="lineNum">     120 </span>            :         DynBlockItem *d, *d_was;
<span class="lineNum">     121 </span><span class="lineCov">     635311 :         for (d = first; d; )</span>
<span class="lineNum">     122 </span>            :         {
<span class="lineNum">     123 </span><span class="lineCov">     407847 :             memcpy(p, d -&gt; data, d -&gt; byteCount);</span>
<span class="lineNum">     124 </span><span class="lineCov">     407847 :             p += d -&gt; byteCount;</span>
<span class="lineNum">     125 </span><span class="lineCov">     407847 :             compactedBytes += d -&gt; byteCount;</span>
<span class="lineNum">     126 </span><span class="lineCov">     407847 :             d = (d_was = d) -&gt; next;</span>
<span class="lineNum">     127 </span><span class="lineCov">     407847 :             if (kill_)</span>
<span class="lineNum">     128 </span>            :             {
<span class="lineNum">     129 </span><span class="lineCov">     407847 :                 delete[] d_was -&gt; data;</span>
<span class="lineNum">     130 </span><span class="lineCov">     407847 :                 delete d_was;</span>
<span class="lineNum">     131 </span>            :             }
<span class="lineNum">     132 </span>            :         };
<span class="lineNum">     133 </span><span class="lineCov">     227464 :         if (kill_)</span>
<span class="lineNum">     134 </span>            :         {
<span class="lineNum">     135 </span><span class="lineCov">     227464 :             first = last = NULL;</span>
<span class="lineNum">     136 </span><span class="lineCov">     227464 :             byteCount = 0;</span>
<span class="lineNum">     137 </span>            :         }
<span class="lineNum">     138 </span>            :     }
<span class="lineNum">     139 </span><span class="lineCov">     227464 :     return compactedBytes;</span>
<span class="lineNum">     140 </span>            : }
<span class="lineNum">     141 </span>            : 
<span class="lineNum">     142 </span>            : 
<span class="lineNum">     143 </span>            : #define thisNoConst (const_cast&lt;DynBlock*&gt;(this))
<a name="144"><span class="lineNum">     144 </span>            : </a>
<span class="lineNum">     145 </span>            : 
<span class="lineNum">     146 </span><span class="lineNoCov">          0 : char* DynBlock::compactToBuffer() const</span>
<span class="lineNum">     147 </span>            : {
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :     char *newdata = new char[byteCount+1];</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :     newdata[thisNoConst -&gt; compactToBuffer_(newdata, FALSE)] = 0;</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :     return newdata;</span>
<a name="151"><span class="lineNum">     151 </span>            : }</a>
<span class="lineNum">     152 </span>            : 
<span class="lineNum">     153 </span><span class="lineNoCov">          0 : void DynBlock::compact() const</span>
<span class="lineNum">     154 </span>            : {
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :     if (!first || !(first -&gt; next)) return;</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :     int byteCountWas = byteCount;</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :     char *newdata = new char[byteCount];</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :     thisNoConst -&gt; compactToBuffer_(newdata, TRUE);</span>
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :     thisNoConst -&gt; first = thisNoConst -&gt; last = new DynBlockItem;</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :     thisNoConst -&gt; first -&gt; data = newdata;</span>
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :     thisNoConst -&gt; byteCount = first -&gt; byteCount = byteCountWas;</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :     thisNoConst -&gt; first -&gt; next = NULL;</span>
<span class="lineNum">     163 </span>            : }
<span class="lineNum">     164 </span>            : 
<span class="lineNum">     165 </span>            : 
<span class="lineNum">     166 </span>            : 
<span class="lineNum">     167 </span>            : //
<span class="lineNum">     168 </span>            : //     DynStrBlock
<span class="lineNum">     169 </span>            : //     a flavour of DynBlock for use in dynamic strings
<span class="lineNum">     170 </span>            : //
<span class="lineNum">     171 </span>            : // compactString() allocates a new buffer to hold 'firstPart'
<span class="lineNum">     172 </span>            : // plus the concat of all the DynStrBlock's parts. Kills the parts
<a name="173"><span class="lineNum">     173 </span>            : // of the DynStrBlock.</a>
<span class="lineNum">     174 </span>            : //
<span class="lineNum">     175 </span><span class="lineCov">     227464 : char* DynStrBlock::compactString_(const char *firstPart, int firstLen)</span>
<span class="lineNum">     176 </span>            : {
<span class="lineNum">     177 </span><span class="lineCov">     227464 :     int newLength = firstLen + byteCount;</span>
<span class="lineNum">     178 </span><span class="lineCov">     227464 :     char *newdata = new char[newLength + 1];</span>
<span class="lineNum">     179 </span><span class="lineCov">     227464 :     if (firstLen)</span>
<span class="lineNum">     180 </span><span class="lineCov">      48536 :         memcpy(newdata, firstPart, firstLen);</span>
<span class="lineNum">     181 </span><span class="lineCov">     227464 :     if (first)</span>
<span class="lineNum">     182 </span><span class="lineCov">     227464 :         compactToBuffer_(newdata + firstLen, TRUE);</span>
<span class="lineNum">     183 </span><span class="lineCov">     227464 :     newdata[newLength] = 0;</span>
<span class="lineNum">     184 </span><span class="lineCov">     227464 :     return newdata;</span>
<span class="lineNum">     185 </span>            : }
<span class="lineNum">     186 </span>            : 
<span class="lineNum">     187 </span>            : 
<span class="lineNum">     188 </span>            : 
<span class="lineNum">     189 </span>            : 
<span class="lineNum">     190 </span>            : //
<span class="lineNum">     191 </span>            : //                Str
<span class="lineNum">     192 </span>            : //                static string
<span class="lineNum">     193 </span>            : //
<a name="194"><span class="lineNum">     194 </span>            : </a>
<span class="lineNum">     195 </span>            : 
<span class="lineNum">     196 </span><span class="lineCov">    1262414 : Str::Str()</span>
<span class="lineNum">     197 </span>            : {
<span class="lineNum">     198 </span><span class="lineCov">    1262414 :     text_ = NULL;</span>
<span class="lineNum">     199 </span><span class="lineCov">    1262414 :     byteLength_ = 0;</span>
<a name="200"><span class="lineNum">     200 </span><span class="lineCov">     609280 : }</span></a>
<span class="lineNum">     201 </span>            : 
<span class="lineNum">     202 </span><span class="lineCov">     114028 : Str::Str(const Str&amp; string)</span>
<span class="lineNum">     203 </span>            : {
<span class="lineNum">     204 </span><span class="lineCov">     114028 :     text_ = NULL;</span>
<span class="lineNum">     205 </span><span class="lineCov">     114028 :     operator= (string);</span>
<a name="206"><span class="lineNum">     206 </span><span class="lineCov">      94260 : }</span></a>
<span class="lineNum">     207 </span>            : 
<span class="lineNum">     208 </span><span class="lineCov">       7924 : Str::Str(char c)</span>
<span class="lineNum">     209 </span>            : {
<span class="lineNum">     210 </span><span class="lineCov">       7924 :     text_ = NULL;</span>
<span class="lineNum">     211 </span><span class="lineCov">       7924 :     operator= (c);</span>
<a name="212"><span class="lineNum">     212 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     213 </span>            : 
<span class="lineNum">     214 </span><span class="lineNoCov">          0 : Str::Str(int num)</span>
<span class="lineNum">     215 </span>            : {
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :     text_ = NULL;</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :     operator= (num);</span>
<a name="218"><span class="lineNum">     218 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     219 </span>            : 
<span class="lineNum">     220 </span><span class="lineNoCov">          0 : Str::Str(double num)</span>
<span class="lineNum">     221 </span>            : {
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :     text_ = NULL;</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :     operator= (num);</span>
<a name="224"><span class="lineNum">     224 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     225 </span>            : 
<span class="lineNum">     226 </span><span class="lineCov">     531049 : Str::Str(const char *chars)</span>
<span class="lineNum">     227 </span>            : {
<span class="lineNum">     228 </span><span class="lineCov">     531049 :     if (!chars) </span>
<span class="lineNum">     229 </span><span class="lineCov">      18065 :         chars=&quot;&quot;;</span>
<span class="lineNum">     230 </span><span class="lineCov">     531049 :     text_ = NULL;</span>
<span class="lineNum">     231 </span><span class="lineCov">     531049 :     operator= (chars);</span>
<a name="232"><span class="lineNum">     232 </span><span class="lineCov">     531049 : }</span></a>
<span class="lineNum">     233 </span>            : 
<span class="lineNum">     234 </span><span class="lineCov">      81752 : Str::Str(const DStr &amp;dstring)</span>
<span class="lineNum">     235 </span>            : {
<span class="lineNum">     236 </span><span class="lineCov">      81752 :     text_ = NULL;</span>
<span class="lineNum">     237 </span><span class="lineCov">      81752 :     operator= (dstring);</span>
<a name="238"><span class="lineNum">     238 </span><span class="lineCov">      81752 : }</span></a>
<span class="lineNum">     239 </span>            : 
<span class="lineNum">     240 </span><span class="lineCov">     554501 : Str&amp; Str::operator=(const Str&amp; string)</span>
<span class="lineNum">     241 </span>            : {
<span class="lineNum">     242 </span><span class="lineCov">     554501 :     remove_();</span>
<span class="lineNum">     243 </span><span class="lineCov">     554501 :     int hisByteLen = string.length();</span>
<span class="lineNum">     244 </span><span class="lineCov">     554501 :     byteLength_ = hisByteLen;</span>
<span class="lineNum">     245 </span><span class="lineCov">     554501 :     text_ = claimMemory(hisByteLen + 1);</span>
<span class="lineNum">     246 </span><span class="lineCov">     554501 :     memcpy(operator char*(), string.operator char*(), hisByteLen+1);</span>
<span class="lineNum">     247 </span><span class="lineCov">     554501 :     return *this;</span>
<a name="248"><span class="lineNum">     248 </span>            : }</a>
<span class="lineNum">     249 </span>            : 
<span class="lineNum">     250 </span><span class="lineCov">     176118 : Str&amp; Str::operator=(const DStr&amp; dynamic)</span>
<span class="lineNum">     251 </span>            : {
<span class="lineNum">     252 </span><span class="lineCov">     176118 :     remove_();</span>
<span class="lineNum">     253 </span><span class="lineCov">     176118 :     nset((char*) dynamic, dynamic.length());</span>
<span class="lineNum">     254 </span><span class="lineCov">     176118 :     return *this;</span>
<a name="255"><span class="lineNum">     255 </span>            : }</a>
<span class="lineNum">     256 </span>            : 
<span class="lineNum">     257 </span><span class="lineCov">     557685 : Str&amp; Str::operator=(const char* chars)</span>
<span class="lineNum">     258 </span>            : {
<span class="lineNum">     259 </span><span class="lineCov">     557685 :     nset(NZ(chars), strlen(chars));</span>
<span class="lineNum">     260 </span><span class="lineCov">     557685 :     return *this;</span>
<a name="261"><span class="lineNum">     261 </span>            : }</a>
<span class="lineNum">     262 </span>            : 
<span class="lineNum">     263 </span><span class="lineCov">       7924 : Str&amp; Str::operator= (char c)</span>
<span class="lineNum">     264 </span>            : {
<span class="lineNum">     265 </span><span class="lineCov">       7924 :     remove_();</span>
<span class="lineNum">     266 </span>            :     char *p;
<span class="lineNum">     267 </span><span class="lineCov">       7924 :     *(p = claimMemory(2)) = c;</span>
<span class="lineNum">     268 </span><span class="lineCov">       7924 :     p[1] = 0;</span>
<span class="lineNum">     269 </span><span class="lineCov">       7924 :     byteLength_ = 1;</span>
<span class="lineNum">     270 </span><span class="lineCov">       7924 :     text_ = p;</span>
<span class="lineNum">     271 </span><span class="lineCov">       7924 :     return *this;</span>
<a name="272"><span class="lineNum">     272 </span>            : }</a>
<span class="lineNum">     273 </span>            : 
<span class="lineNum">     274 </span><span class="lineCov">        682 : Str&amp; Str::operator= (int num)</span>
<span class="lineNum">     275 </span>            : {
<span class="lineNum">     276 </span><span class="lineCov">        682 :     remove_();</span>
<span class="lineNum">     277 </span>            :     char buf[20];
<span class="lineNum">     278 </span>            :     sprintf(buf,&quot;%d&quot;,num);
<span class="lineNum">     279 </span><span class="lineCov">        682 :     operator=(buf);</span>
<span class="lineNum">     280 </span><span class="lineCov">        682 :     return *this;</span>
<a name="281"><span class="lineNum">     281 </span>            : }</a>
<span class="lineNum">     282 </span>            : 
<span class="lineNum">     283 </span><span class="lineCov">          3 : Str&amp; Str::operator= (double num)</span>
<span class="lineNum">     284 </span>            : {
<span class="lineNum">     285 </span><span class="lineCov">          3 :     remove_();</span>
<span class="lineNum">     286 </span>            :     char buf[20];
<span class="lineNum">     287 </span>            :     sprintf(buf,&quot;%.13g&quot;,num);
<span class="lineNum">     288 </span><span class="lineCov">          3 :     operator=(buf);</span>
<span class="lineNum">     289 </span><span class="lineCov">          3 :     return *this;</span>
<a name="290"><span class="lineNum">     290 </span>            : }</a>
<span class="lineNum">     291 </span>            : 
<span class="lineNum">     292 </span><span class="lineCov">    1430014 : void Str::nset(const char* chars, int len)</span>
<span class="lineNum">     293 </span>            : {
<span class="lineNum">     294 </span><span class="lineCov">    1430014 :     sabassert(chars);</span>
<span class="lineNum">     295 </span><span class="lineCov">    1430014 :     remove_();</span>
<span class="lineNum">     296 </span><span class="lineCov">    1430014 :     byteLength_ = len;</span>
<span class="lineNum">     297 </span><span class="lineCov">    1430014 :     text_ = claimMemory(len + 1);</span>
<span class="lineNum">     298 </span><span class="lineCov">    1430014 :     memcpy(text_, chars, len);</span>
<span class="lineNum">     299 </span><span class="lineCov">    1430014 :     text_[len] = 0;</span>
<a name="300"><span class="lineNum">     300 </span><span class="lineCov">    1430014 : }</span></a>
<span class="lineNum">     301 </span>            : 
<span class="lineNum">     302 </span><span class="lineCov">       5184 : char Str::operator[] (int index) const</span>
<span class="lineNum">     303 </span>            : {
<span class="lineNum">     304 </span><span class="lineCov">       5184 :     sabassert(index &gt;= 0 &amp;&amp; index &lt;= length());</span>
<span class="lineNum">     305 </span><span class="lineCov">       5184 :     pack_();</span>
<span class="lineNum">     306 </span><span class="lineCov">       5184 :     return text_[index];</span>
<a name="307"><span class="lineNum">     307 </span>            : }</a>
<span class="lineNum">     308 </span>            : 
<a name="309"><span class="lineNum">     309 </span><span class="lineCov">     136897 : Bool Str::isEmpty() const</span></a>
<span class="lineNum">     310 </span>            : {
<span class="lineNum">     311 </span><span class="lineCov">     250136 :     return !length(); // this is virtual</span>
<a name="312"><span class="lineNum">     312 </span>            : }</a>
<span class="lineNum">     313 </span>            : 
<span class="lineNum">     314 </span><span class="lineCov">    1726631 : int Str::length() const</span>
<span class="lineNum">     315 </span>            : {
<span class="lineNum">     316 </span><span class="lineCov">    1726631 :     return byteLength_;</span>
<a name="317"><span class="lineNum">     317 </span>            : }</a>
<span class="lineNum">     318 </span>            : 
<a name="319"><span class="lineNum">     319 </span><span class="lineCov">    3318556 : Str::operator char*() const</span></a>
<span class="lineNum">     320 </span>            : {
<span class="lineNum">     321 </span><span class="lineCov">    3731071 :     if (!text_)</span>
<span class="lineNum">     322 </span><span class="lineCov">      34793 :         const_cast&lt;Str*&gt;(this) -&gt; empty();</span>
<span class="lineNum">     323 </span><span class="lineCov">    3731071 :     return text_;</span>
<a name="324"><span class="lineNum">     324 </span>            : }</a>
<span class="lineNum">     325 </span>            : 
<span class="lineNum">     326 </span><span class="lineCov">     766669 : void Str::empty()</span>
<span class="lineNum">     327 </span>            : {
<span class="lineNum">     328 </span><span class="lineCov">     766669 :     byteLength_ = 0;</span>
<span class="lineNum">     329 </span><span class="lineCov">     766669 :     remove_();</span>
<span class="lineNum">     330 </span><span class="lineCov">     766669 :     *(text_ = claimMemory(1)) = 0;</span>
<a name="331"><span class="lineNum">     331 </span><span class="lineCov">     766669 : }</span></a>
<span class="lineNum">     332 </span>            : 
<span class="lineNum">     333 </span><span class="lineNoCov">          0 : int Str::compare(const char* otherChars) const</span>
<span class="lineNum">     334 </span>            : {
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :     int cmp = strcmp(operator char*(), otherChars);</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :     if (!cmp)</span>
<span class="lineNum">     337 </span>            :         return 0;
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :     else return (cmp &gt; 0 ? 1 : -1);</span>
<a name="339"><span class="lineNum">     339 </span>            : }</a>
<span class="lineNum">     340 </span>            : 
<span class="lineNum">     341 </span><span class="lineNoCov">          0 : int Str::compare(const Str&amp; other) const</span>
<span class="lineNum">     342 </span>            : {
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :     return compare((const char*) other);</span>
<a name="344"><span class="lineNum">     344 </span>            : }</a>
<span class="lineNum">     345 </span>            : 
<span class="lineNum">     346 </span><span class="lineCov">     488698 : Bool Str::operator== (const Str&amp; other) const</span>
<span class="lineNum">     347 </span>            : {
<span class="lineNum">     348 </span><span class="lineCov">     488698 :     return (Bool) !strcmp(operator char*(), (char*) other);</span>
<a name="349"><span class="lineNum">     349 </span>            : }</a>
<span class="lineNum">     350 </span>            : 
<span class="lineNum">     351 </span><span class="lineCov">     152739 : Bool Str::operator== (const char* otherChars) const</span>
<span class="lineNum">     352 </span>            : {
<span class="lineNum">     353 </span><span class="lineCov">     152739 :     return (Bool) !strcmp(operator char*(), otherChars);</span>
<a name="354"><span class="lineNum">     354 </span>            : }</a>
<span class="lineNum">     355 </span>            : 
<span class="lineNum">     356 </span><span class="lineCov">        811 : Bool Str::operator== (char* otherChars) const</span>
<span class="lineNum">     357 </span>            : {
<span class="lineNum">     358 </span><span class="lineCov">        811 :     return (Bool) !strcmp(operator char*(), otherChars);</span>
<a name="359"><span class="lineNum">     359 </span>            : }</a>
<span class="lineNum">     360 </span>            : 
<span class="lineNum">     361 </span><span class="lineNoCov">          0 : Bool Str::eqNoCase (const Str&amp; other) const</span>
<span class="lineNum">     362 </span>            : {
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :     return (strEqNoCase(operator char*(), (char*) other) ? TRUE : FALSE);</span>
<a name="364"><span class="lineNum">     364 </span>            : }</a>
<span class="lineNum">     365 </span>            : 
<span class="lineNum">     366 </span><span class="lineCov">      25742 : Bool Str::eqNoCase (const char* other) const</span>
<span class="lineNum">     367 </span>            : {
<span class="lineNum">     368 </span><span class="lineCov">      25742 :     return (strEqNoCase(operator char*(), other) ? TRUE : FALSE);</span>
<a name="369"><span class="lineNum">     369 </span>            : }</a>
<span class="lineNum">     370 </span>            : 
<a name="371"><span class="lineNum">     371 </span><span class="lineNoCov">          0 : Bool Str::operator&lt; (const char* other)</span></a>
<span class="lineNum">     372 </span>            : {
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :     return compare(other) &lt; 0;</span>
<span class="lineNum">     374 </span>            : }
<span class="lineNum">     375 </span>            : 
<span class="lineNum">     376 </span><span class="lineNoCov">          0 : Bool Str::operator&lt; (const Str &amp;other)</span>
<span class="lineNum">     377 </span>            : {
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :   return operator&lt;((const char*) other);</span>
<a name="379"><span class="lineNum">     379 </span>            : }</a>
<span class="lineNum">     380 </span>            : 
<span class="lineNum">     381 </span><span class="lineNoCov">          0 : Bool Str::toDouble(double &amp;d) const</span>
<span class="lineNum">     382 </span>            : {
<span class="lineNum">     383 </span>            :     char *stopper;
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :     d = strtod(operator char*(),&amp;stopper);</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :     return (!!*stopper);</span>
<span class="lineNum">     386 </span>            : }
<span class="lineNum">     387 </span>            : 
<span class="lineNum">     388 </span><span class="lineCov">    1845391 : Str::~Str()</span>
<span class="lineNum">     389 </span>            : {
<span class="lineNum">     390 </span>            :     remove_();
<a name="391"><span class="lineNum">     391 </span><span class="lineCov">    1463572 : }</span></a>
<span class="lineNum">     392 </span>            : 
<span class="lineNum">     393 </span><span class="lineNoCov">          0 : DStr&amp; Str::appendSelf(DStr&amp; other)</span>
<span class="lineNum">     394 </span>            : {
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :     other.nadd(operator char*(), length());</span>
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :     remove_();</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :     return other;</span>
<a name="398"><span class="lineNum">     398 </span>            : }</a>
<span class="lineNum">     399 </span>            : 
<span class="lineNum">     400 </span><span class="lineCov">      14171 : DStr Str::operator+ (const Str&amp; other) const</span>
<span class="lineNum">     401 </span>            : {
<span class="lineNum">     402 </span><span class="lineCov">      14171 :     pack_();</span>
<span class="lineNum">     403 </span><span class="lineCov">      14171 :     other.pack_();</span>
<span class="lineNum">     404 </span><span class="lineCov">      14171 :     DStr temp(*this);</span>
<span class="lineNum">     405 </span><span class="lineCov">      14171 :     temp += other;</span>
<span class="lineNum">     406 </span><span class="lineCov">      14171 :     return temp;</span>
<a name="407"><span class="lineNum">     407 </span>            : }</a>
<span class="lineNum">     408 </span>            : 
<span class="lineNum">     409 </span><span class="lineCov">       5184 : DStr Str::operator+ (const char* otherChars) const</span>
<span class="lineNum">     410 </span>            : {
<span class="lineNum">     411 </span><span class="lineCov">       5184 :     pack_();</span>
<span class="lineNum">     412 </span><span class="lineCov">       5184 :     DStr temp(*this);</span>
<span class="lineNum">     413 </span><span class="lineCov">       5184 :     temp += otherChars;</span>
<span class="lineNum">     414 </span><span class="lineCov">       5184 :     return temp;</span>
<a name="415"><span class="lineNum">     415 </span>            : }</a>
<span class="lineNum">     416 </span>            : 
<span class="lineNum">     417 </span><span class="lineNoCov">          0 : DStr Str::operator+ (int num) const</span>
<span class="lineNum">     418 </span>            : {
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :     pack_();</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :     DStr temp(*this);</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :     temp += num;</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :     return temp;</span>
<span class="lineNum">     423 </span>            : }
<span class="lineNum">     424 </span>            : 
<span class="lineNum">     425 </span>            : 
<span class="lineNum">     426 </span>            : // pack_() is overridden in DStr to put the pieces of the dynamic
<a name="427"><span class="lineNum">     427 </span>            : // string together</a>
<span class="lineNum">     428 </span>            : //
<span class="lineNum">     429 </span><span class="lineCov">      24539 : void Str::pack_() const</span>
<span class="lineNum">     430 </span>            : {
<span class="lineNum">     431 </span><span class="lineCov">      24539 :     if (!text_)</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :         const_cast&lt;Str*&gt;(this) -&gt; empty();</span>
<span class="lineNum">     433 </span><span class="lineCov">      24539 : };</span>
<span class="lineNum">     434 </span>            : 
<span class="lineNum">     435 </span>            : 
<span class="lineNum">     436 </span>            : // a ridiculous old function (almost dead)
<a name="437"><span class="lineNum">     437 </span>            : // FIXME: do away with it and namechar() too</a>
<span class="lineNum">     438 </span>            : //
<span class="lineNum">     439 </span><span class="lineNoCov">          0 : void Str::speakTerse(DStr &amp;ret)</span>
<span class="lineNum">     440 </span>            : {
<span class="lineNum">     441 </span>            :     int i;
<span class="lineNum">     442 </span>            :     char c;
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :     pack_();</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; length(); i++)</span>
<span class="lineNum">     445 </span>            :     {
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :         switch(c = (*this)[i])</span>
<span class="lineNum">     447 </span>            :         {
<span class="lineNum">     448 </span>            :         case '\n': 
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :             ret += &quot;&amp;#10;&quot;; break;</span>
<span class="lineNum">     450 </span>            :         case '\t': 
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :             ret += &quot;&amp;#9;&quot;; break;</span>
<span class="lineNum">     452 </span>            :         default:
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :             ret += c;</span>
<span class="lineNum">     454 </span>            :         };
<span class="lineNum">     455 </span>            :     };
<a name="456"><span class="lineNum">     456 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     457 </span>            : 
<span class="lineNum">     458 </span><span class="lineNoCov">          0 : char* Str::cloneData()</span>
<span class="lineNum">     459 </span>            : {
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :   pack_();</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :   char *ret = new char[length() + 1];</span>
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :   if </span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :     (text_) strcpy(ret, text_);</span>
<span class="lineNum">     464 </span>            :   else 
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :     *ret = 0;</span>
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :   return ret;</span>
<span class="lineNum">     467 </span>            : }
<span class="lineNum">     468 </span>            : 
<span class="lineNum">     469 </span>            : 
<span class="lineNum">     470 </span>            : //
<span class="lineNum">     471 </span>            : //
<span class="lineNum">     472 </span>            : //                  DStr
<span class="lineNum">     473 </span>            : //                  dynamic string
<span class="lineNum">     474 </span>            : //
<span class="lineNum">     475 </span>            : //
<span class="lineNum">     476 </span>            : 
<span class="lineNum">     477 </span>            : 
<span class="lineNum">     478 </span><span class="lineCov">     450260 : DStr::DStr()</span>
<span class="lineNum">     479 </span>            : {
<span class="lineNum">     480 </span><span class="lineCov">     157969 : };</span>
<span class="lineNum">     481 </span>            : 
<span class="lineNum">     482 </span><span class="lineNoCov">          0 : DStr::DStr(char c)</span>
<span class="lineNum">     483 </span>            : {
<span class="lineNum">     484 </span>            :     // was: text = NULL 
<span class="lineNum">     485 </span>            :     // which leaks memory since Str::Str() is called
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :     returnMemory(text_);</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :     operator+=(c);</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 : };</span>
<span class="lineNum">     489 </span><span class="lineCov">     109986 : DStr::DStr(const char *chars)</span>
<span class="lineNum">     490 </span>            : {
<span class="lineNum">     491 </span>            :     // was: text = NULL 
<span class="lineNum">     492 </span>            :     // which leaks memory since Str::Str() is called
<span class="lineNum">     493 </span><span class="lineCov">      54993 :     returnMemory(text_);</span>
<span class="lineNum">     494 </span><span class="lineCov">      54993 :     operator+=(chars);</span>
<span class="lineNum">     495 </span><span class="lineCov">      54993 : };</span>
<span class="lineNum">     496 </span>            : 
<span class="lineNum">     497 </span><span class="lineCov">     143612 : DStr::DStr(const Str&amp; string)</span>
<span class="lineNum">     498 </span>            : {
<span class="lineNum">     499 </span>            :     // was: text = NULL 
<span class="lineNum">     500 </span>            :     // which leaks memory since Str::Str() is called
<span class="lineNum">     501 </span><span class="lineCov">      71806 :     returnMemory(text_);</span>
<span class="lineNum">     502 </span><span class="lineCov">      71806 :     operator+=(string);</span>
<span class="lineNum">     503 </span><span class="lineCov">      71806 : };</span>
<span class="lineNum">     504 </span>            : 
<span class="lineNum">     505 </span><span class="lineCov">      21966 : DStr::DStr(const DStr&amp; dstring)</span>
<span class="lineNum">     506 </span><span class="lineCov">      43932 :   : Str()</span>
<span class="lineNum">     507 </span>            : {
<span class="lineNum">     508 </span>            :     // was: text = NULL 
<span class="lineNum">     509 </span>            :     // which leaks memory since Str::Str() is called
<span class="lineNum">     510 </span><span class="lineCov">      21966 :     returnMemory(text_);</span>
<span class="lineNum">     511 </span><span class="lineCov">      21966 :     operator+=(dstring);</span>
<a name="512"><span class="lineNum">     512 </span><span class="lineCov">      21966 : };</span></a>
<span class="lineNum">     513 </span>            : 
<span class="lineNum">     514 </span><span class="lineCov">      42654 : DStr&amp; DStr::operator=(const DStr&amp; other)</span>
<span class="lineNum">     515 </span>            : {
<span class="lineNum">     516 </span><span class="lineCov">      42654 :     remove_();</span>
<span class="lineNum">     517 </span><span class="lineCov">      42654 :     operator+=(other);</span>
<span class="lineNum">     518 </span><span class="lineCov">      42654 :     return *this;</span>
<span class="lineNum">     519 </span>            : }
<a name="520"><span class="lineNum">     520 </span>            : </a>
<span class="lineNum">     521 </span>            : 
<span class="lineNum">     522 </span><span class="lineCov">     771270 : DStr&amp; DStr::nadd(const char *adding, int len)</span>
<span class="lineNum">     523 </span>            : {
<span class="lineNum">     524 </span><span class="lineCov">     771270 :     sabassert(adding);</span>
<span class="lineNum">     525 </span><span class="lineCov">     771270 :     if (text_)</span>
<span class="lineNum">     526 </span><span class="lineCov">     466099 :         blocks.nadd(adding, len);</span>
<span class="lineNum">     527 </span>            :     else
<span class="lineNum">     528 </span><span class="lineCov">     305171 :         nset(adding,len);</span>
<span class="lineNum">     529 </span><span class="lineCov">     771270 :     return *this;</span>
<span class="lineNum">     530 </span>            : }
<a name="531"><span class="lineNum">     531 </span>            : </a>
<span class="lineNum">     532 </span>            : 
<span class="lineNum">     533 </span><span class="lineCov">     162110 : DStr&amp; DStr::operator+= (const char *adding)</span>
<span class="lineNum">     534 </span>            : {
<span class="lineNum">     535 </span><span class="lineCov">     162110 :     if (!text_ || *adding)</span>
<span class="lineNum">     536 </span><span class="lineCov">     162110 :         nadd(adding, strlen(adding));</span>
<span class="lineNum">     537 </span><span class="lineCov">     162110 :     return *this;</span>
<a name="538"><span class="lineNum">     538 </span>            : }</a>
<span class="lineNum">     539 </span>            : 
<span class="lineNum">     540 </span><span class="lineCov">     233766 : DStr&amp; DStr::operator+= (const Str&amp; addingStr)</span>
<span class="lineNum">     541 </span>            : {
<span class="lineNum">     542 </span><span class="lineCov">     233766 :     nadd((char*) addingStr, addingStr.length());</span>
<span class="lineNum">     543 </span><span class="lineCov">     233766 :     return *this;</span>
<a name="544"><span class="lineNum">     544 </span>            : }</a>
<span class="lineNum">     545 </span>            : 
<span class="lineNum">     546 </span><span class="lineCov">      89810 : DStr&amp; DStr::operator+=(const DStr&amp; other)</span>
<span class="lineNum">     547 </span>            : {
<span class="lineNum">     548 </span><span class="lineCov">      89810 :     if (!other.text_) return *this;</span>
<span class="lineNum">     549 </span><span class="lineCov">      89810 :     nadd(other.text_, other.byteLength_);</span>
<span class="lineNum">     550 </span>            :     DynBlockItem *b;
<span class="lineNum">     551 </span><span class="lineCov">     138926 :     for (b = other.blocks.first; b; b = b -&gt; next)</span>
<span class="lineNum">     552 </span><span class="lineCov">      49116 :         nadd(b -&gt; data, b -&gt; byteCount);</span>
<span class="lineNum">     553 </span>            :     return *this;
<span class="lineNum">     554 </span>            : }
<span class="lineNum">     555 </span>            : 
<span class="lineNum">     556 </span><span class="lineNoCov">          0 : DStr&amp; DStr::operator+= (int addingnum)</span>
<span class="lineNum">     557 </span>            : {
<span class="lineNum">     558 </span>            :     Str temp = addingnum;
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :     return operator +=(temp);</span>
<span class="lineNum">     560 </span>            : }
<span class="lineNum">     561 </span>            : 
<span class="lineNum">     562 </span><span class="lineCov">       7924 : DStr&amp; DStr::operator+= (char addingc)</span>
<span class="lineNum">     563 </span>            : {
<span class="lineNum">     564 </span><span class="lineCov">       7924 :     Str temp = addingc;</span>
<span class="lineNum">     565 </span><span class="lineCov">      15848 :     return operator +=(temp);</span>
<a name="566"><span class="lineNum">     566 </span>            : }</a>
<span class="lineNum">     567 </span>            : 
<span class="lineNum">     568 </span><span class="lineNoCov">          0 : DStr&amp; DStr::appendSelf(DStr&amp; other)</span>
<span class="lineNum">     569 </span>            : {
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :     other.nadd(text_, byteLength_);</span>
<span class="lineNum">     571 </span>            :     DynBlockItem *b;
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :     for (b = blocks.first; b; b = b -&gt; next)</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :         other.nadd(b -&gt; data, b -&gt; byteCount);</span>
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :     remove_();</span>
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :     byteLength_ = 0;</span>
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :     return other;</span>
<a name="577"><span class="lineNum">     577 </span>            : }</a>
<span class="lineNum">     578 </span>            : 
<span class="lineNum">     579 </span><span class="lineCov">    1167471 : DStr::~DStr()</span>
<span class="lineNum">     580 </span>            : {
<span class="lineNum">     581 </span><span class="lineCov">     373895 :     remove_();</span>
<a name="582"><span class="lineNum">     582 </span><span class="lineCov">     419681 : }</span></a>
<span class="lineNum">     583 </span>            : 
<span class="lineNum">     584 </span><span class="lineCov">    1338512 : void DStr::remove_()</span>
<span class="lineNum">     585 </span>            : {
<span class="lineNum">     586 </span><span class="lineCov">    1338512 :     returnMemory(text_);</span>
<span class="lineNum">     587 </span><span class="lineCov">    1338512 :     blocks.remove();   </span>
<a name="588"><span class="lineNum">     588 </span><span class="lineCov">    1338512 : }</span></a>
<span class="lineNum">     589 </span>            : 
<span class="lineNum">     590 </span><span class="lineCov">     426686 : void DStr::pack_() const</span>
<span class="lineNum">     591 </span>            : {
<span class="lineNum">     592 </span>            :     // if not needed leave asap
<span class="lineNum">     593 </span><span class="lineCov">     625908 :     if (blocks.isEmpty()) return;</span>
<span class="lineNum">     594 </span><span class="lineCov">     227464 :     int blocksLen = blocks.byteCount;</span>
<span class="lineNum">     595 </span>            :     // concat text_ with the contents of all blocks
<span class="lineNum">     596 </span><span class="lineCov">     227464 :     char *oldText_ = const_cast&lt;DStr*&gt;(this) -&gt; text_;</span>
<span class="lineNum">     597 </span>            :     const_cast&lt;DStr*&gt;(this) -&gt; text_ =
<span class="lineNum">     598 </span>            :         const_cast&lt;DynStrBlock*&gt;(&amp;blocks) -&gt; 
<span class="lineNum">     599 </span><span class="lineCov">     227464 :         compactString_(text_, byteLength_);</span>
<span class="lineNum">     600 </span><span class="lineCov">     227464 :     returnMemory(oldText_);</span>
<span class="lineNum">     601 </span><span class="lineCov">     227464 :     const_cast&lt;DStr*&gt;(this) -&gt; byteLength_ += blocksLen;</span>
<span class="lineNum">     602 </span>            :     // the length stays the same
<a name="603"><span class="lineNum">     603 </span>            : }</a>
<span class="lineNum">     604 </span>            : 
<span class="lineNum">     605 </span><span class="lineCov">     402743 : int DStr::length() const</span>
<span class="lineNum">     606 </span>            : {
<span class="lineNum">     607 </span><span class="lineCov">     402743 :     return byteLength_ + blocks.byteCount; </span>
<span class="lineNum">     608 </span>            : }
<span class="lineNum">     609 </span>            : 
<span class="lineNum">     610 </span><span class="lineCov">     412515 : DStr::operator char* () const</span>
<span class="lineNum">     611 </span>            : {
<span class="lineNum">     612 </span><span class="lineCov">     412515 :     pack_();</span>
<span class="lineNum">     613 </span><span class="lineCov">     825030 :     return Str::operator char*();</span>
<span class="lineNum">     614 </span>            : }
<span class="lineNum">     615 </span>            : 
<span class="lineNum">     616 </span>            : 
<span class="lineNum">     617 </span>            : 
<span class="lineNum">     618 </span>            : //
<span class="lineNum">     619 </span>            : //
<span class="lineNum">     620 </span>            : //  string functions
<span class="lineNum">     621 </span>            : //
<a name="622"><span class="lineNum">     622 </span>            : //</a>
<span class="lineNum">     623 </span>            : 
<span class="lineNum">     624 </span><span class="lineNoCov">          0 : void escapeChars(DStr&amp; result, const Str&amp; what, </span>
<span class="lineNum">     625 </span>            :                  const char* toEscape, const char** substitutes)
<span class="lineNum">     626 </span>            : {
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :     char *pStart = what, *p = pStart;</span>
<span class="lineNum">     628 </span>            :     int chunkLength;
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :     while (pStart)</span>
<span class="lineNum">     630 </span>            :     {
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :         p = strpbrk(pStart, toEscape);</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :         if (p)</span>
<span class="lineNum">     633 </span>            :         {
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :             if ((chunkLength = (int)(p - pStart)))</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :                 result.nadd(pStart, chunkLength);</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :             result += substitutes[(int) (NZ(strchr(toEscape, *p)) - toEscape)];</span>
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :             pStart = ++p;</span>
<span class="lineNum">     638 </span>            :         }
<span class="lineNum">     639 </span>            :         else 
<span class="lineNum">     640 </span>            :         {
<span class="lineNum">     641 </span><span class="lineNoCov">          0 :             result += pStart;</span>
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :             pStart = NULL;</span>
<span class="lineNum">     643 </span>            :         }
<span class="lineNum">     644 </span>            :     }
<span class="lineNum">     645 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     646 </span>            : 
<span class="lineNum">     647 </span>            : 
<span class="lineNum">     648 </span>            : //
<span class="lineNum">     649 </span>            : //
<span class="lineNum">     650 </span>            : //                  QName
<span class="lineNum">     651 </span>            : //                  holds a qname as in the XML spec
<span class="lineNum">     652 </span>            : //
<a name="653"><span class="lineNum">     653 </span>            : //</a>
<span class="lineNum">     654 </span>            : 
<span class="lineNum">     655 </span><span class="lineCov">     676491 : QName::QName()</span>
<span class="lineNum">     656 </span>            : {
<span class="lineNum">     657 </span><span class="lineCov">     676491 :     local = UNDEF_PHRASE;</span>
<span class="lineNum">     658 </span><span class="lineCov">     676491 :     uri = UNDEF_PHRASE;</span>
<span class="lineNum">     659 </span><span class="lineCov">     676491 :     prefix = UNDEF_PHRASE;</span>
<a name="660"><span class="lineNum">     660 </span><span class="lineCov">     676491 : }</span></a>
<span class="lineNum">     661 </span>            : 
<span class="lineNum">     662 </span><span class="lineCov">       1193 : QName::QName(const QName &amp;other)</span>
<span class="lineNum">     663 </span>            : {
<span class="lineNum">     664 </span><span class="lineCov">       1193 :     local = other.local;</span>
<span class="lineNum">     665 </span><span class="lineCov">       1193 :     uri = other.uri;</span>
<span class="lineNum">     666 </span><span class="lineCov">       1193 :     prefix = other.prefix;</span>
<a name="667"><span class="lineNum">     667 </span><span class="lineCov">       1193 : }</span></a>
<span class="lineNum">     668 </span>            : 
<span class="lineNum">     669 </span><span class="lineCov">     150273 : QName&amp; QName::operator =(const QName&amp; other)</span>
<span class="lineNum">     670 </span>            : {
<span class="lineNum">     671 </span><span class="lineCov">     150273 :     local = other.local;</span>
<span class="lineNum">     672 </span><span class="lineCov">     150273 :     uri = other.uri;</span>
<span class="lineNum">     673 </span><span class="lineCov">     150273 :     prefix = other.prefix;</span>
<span class="lineNum">     674 </span><span class="lineCov">     150273 :     return *this;</span>
<a name="675"><span class="lineNum">     675 </span>            : }</a>
<span class="lineNum">     676 </span>            : 
<span class="lineNum">     677 </span><span class="lineNoCov">          0 : Bool QName::isEmpty() const</span>
<span class="lineNum">     678 </span>            : {
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :     return (uri == UNDEF_PHRASE &amp;&amp; local == UNDEF_PHRASE);</span>
<a name="680"><span class="lineNum">     680 </span>            : };</a>
<span class="lineNum">     681 </span>            : 
<span class="lineNum">     682 </span><span class="lineCov">        811 : void QName::empty()</span>
<span class="lineNum">     683 </span>            : {
<span class="lineNum">     684 </span><span class="lineCov">        811 :     prefix = UNDEF_PHRASE;</span>
<span class="lineNum">     685 </span><span class="lineCov">        811 :     local = UNDEF_PHRASE;</span>
<span class="lineNum">     686 </span><span class="lineCov">        811 :     uri = UNDEF_PHRASE;</span>
<span class="lineNum">     687 </span><span class="lineCov">        811 : }</span>
<span class="lineNum">     688 </span>            : 
<span class="lineNum">     689 </span>            : /*
<span class="lineNum">     690 </span>            : void QName::speak(DStr &amp;s, SpeakMode mode) const
<span class="lineNum">     691 </span>            : {
<span class="lineNum">     692 </span>            :     if (prefix != UNDEF_PHRASE)
<span class="lineNum">     693 </span>            :     {
<span class="lineNum">     694 </span>            :         s += dict().getKey(prefix);
<span class="lineNum">     695 </span>            :         s += &quot;:&quot;;
<span class="lineNum">     696 </span>            :     };
<span class="lineNum">     697 </span>            :     s += dict().getKey(local);
<span class="lineNum">     698 </span>            : }
<span class="lineNum">     699 </span>            : */
<span class="lineNum">     700 </span>            : 
<span class="lineNum">     701 </span>            : /*
<span class="lineNum">     702 </span>            : Bool QName::prefixIsNS(const Str &amp;uri2) const
<span class="lineNum">     703 </span>            : {
<span class="lineNum">     704 </span>            :     Phrase uri2Id;
<span class="lineNum">     705 </span>            :     dict().insert(uri2, uri2Id);
<span class="lineNum">     706 </span>            :     return (uri == uri2Id);
<span class="lineNum">     707 </span>            : } 
<a name="708"><span class="lineNum">     708 </span>            : */</a>
<span class="lineNum">     709 </span>            : 
<span class="lineNum">     710 </span><span class="lineCov">      66952 : void QName::setPrefix(Phrase prefix_)</span>
<span class="lineNum">     711 </span>            : {
<span class="lineNum">     712 </span><span class="lineCov">      66952 :     prefix = prefix_;</span>
<span class="lineNum">     713 </span>            : //    dict().insert(pref, prefix);
<span class="lineNum">     714 </span><span class="lineCov">      66952 : }</span>
<a name="715"><span class="lineNum">     715 </span>            : </a>
<span class="lineNum">     716 </span>            : 
<span class="lineNum">     717 </span><span class="lineCov">     487488 : void QName::setLocal(Phrase local_)</span>
<span class="lineNum">     718 </span>            : {
<span class="lineNum">     719 </span><span class="lineCov">     487488 :     local = local_;</span>
<span class="lineNum">     720 </span>            : //    dict().insert(loc, local);
<a name="721"><span class="lineNum">     721 </span><span class="lineCov">     487488 : }</span></a>
<span class="lineNum">     722 </span>            : 
<span class="lineNum">     723 </span><span class="lineCov">      67136 : void QName::setUri(Phrase uri_)</span>
<span class="lineNum">     724 </span>            : {
<span class="lineNum">     725 </span><span class="lineCov">      67136 :     uri = uri_;</span>
<span class="lineNum">     726 </span>            : //    dict().insert(u, uri);
<span class="lineNum">     727 </span><span class="lineCov">      67136 : }</span>
<a name="728"><span class="lineNum">     728 </span>            : </a>
<span class="lineNum">     729 </span>            : 
<a name="730"><span class="lineNum">     730 </span><span class="lineCov">      22397 : Bool QName::operator== (const QName &amp;other) const</span></a>
<span class="lineNum">     731 </span>            : {
<span class="lineNum">     732 </span><span class="lineCov">      22397 :     return local == other.local &amp;&amp; uri == other.uri;</span>
<span class="lineNum">     733 </span>            : }
<span class="lineNum">     734 </span>            : 
<span class="lineNum">     735 </span>            : /*
<span class="lineNum">     736 </span>            : Str QName::getname() const
<span class="lineNum">     737 </span>            : {
<span class="lineNum">     738 </span>            :     DStr s;
<span class="lineNum">     739 </span>            :     speak(s,SM_NAME);
<span class="lineNum">     740 </span>            :     return s;
<span class="lineNum">     741 </span>            : }
<a name="742"><span class="lineNum">     742 </span>            : */</a>
<span class="lineNum">     743 </span>            : 
<a name="744"><span class="lineNum">     744 </span><span class="lineCov">     104953 : Phrase QName::getLocal() const</span></a>
<span class="lineNum">     745 </span>            : {
<span class="lineNum">     746 </span><span class="lineCov">     104953 :     return local;</span>
<span class="lineNum">     747 </span>            : //  return dict().getKey(local);
<a name="748"><span class="lineNum">     748 </span>            : }</a>
<span class="lineNum">     749 </span>            : 
<span class="lineNum">     750 </span><span class="lineCov">     260452 : Phrase QName::getUri() const</span>
<span class="lineNum">     751 </span>            : {
<span class="lineNum">     752 </span><span class="lineCov">     260452 :     return uri;</span>
<span class="lineNum">     753 </span>            : //  return dict().getKey(uri);
<a name="754"><span class="lineNum">     754 </span>            : }</a>
<span class="lineNum">     755 </span>            : 
<span class="lineNum">     756 </span><span class="lineCov">     119679 : Phrase QName::getPrefix() const</span>
<span class="lineNum">     757 </span>            : {
<span class="lineNum">     758 </span><span class="lineCov">     119679 :     return prefix;</span>
<span class="lineNum">     759 </span>            : //  return dict().getKey(prefix);
<a name="760"><span class="lineNum">     760 </span>            : }</a>
<span class="lineNum">     761 </span>            : 
<span class="lineNum">     762 </span><span class="lineNoCov">          0 : Bool QName::hasPrefix() const</span>
<span class="lineNum">     763 </span>            : {
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :    return (prefix != UNDEF_PHRASE);</span>
<span class="lineNum">     765 </span>            : }
<span class="lineNum">     766 </span>            : 
<span class="lineNum">     767 </span>            : 
<span class="lineNum">     768 </span>            : //
<span class="lineNum">     769 </span>            : //
<span class="lineNum">     770 </span>            : //  QNameList
<span class="lineNum">     771 </span>            : //
<span class="lineNum">     772 </span>            : //
<span class="lineNum">     773 </span>            : 
<span class="lineNum">     774 </span><span class="lineNoCov">          0 : int QNameList::findNdx(const QName &amp;what) const</span>
<span class="lineNum">     775 </span>            : {
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :     int count = number();</span>
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :     for (int i = 0; i &lt; count; i++)</span>
<span class="lineNum">     778 </span>            :                 // checking for equality of local and uri
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :                 if ((*this)[i] -&gt; operator==(what))</span>
<span class="lineNum">     780 </span>            :                     return i;
<span class="lineNum">     781 </span>            :     return -1;
<span class="lineNum">     782 </span>            : }
<span class="lineNum">     783 </span>            : 
<span class="lineNum">     784 </span>            : //
<span class="lineNum">     785 </span>            : //    EQName
<span class="lineNum">     786 </span>            : //
<span class="lineNum">     787 </span>            : 
<span class="lineNum">     788 </span><span class="lineCov">     157509 : EQName::EQName()</span>
<span class="lineNum">     789 </span>            : {
<span class="lineNum">     790 </span><span class="lineCov">      52503 : };</span>
<span class="lineNum">     791 </span>            : 
<span class="lineNum">     792 </span><span class="lineCov">      77256 : EQName::EQName(const EQName&amp; other)</span>
<span class="lineNum">     793 </span>            : {
<span class="lineNum">     794 </span><span class="lineCov">      25752 :     prefix = other.getPrefix();</span>
<span class="lineNum">     795 </span><span class="lineCov">      25752 :     uri = other.getUri();</span>
<span class="lineNum">     796 </span><span class="lineCov">      25752 :     local = other.getLocal();</span>
<span class="lineNum">     797 </span><span class="lineCov">      25752 : };</span>
<span class="lineNum">     798 </span>            : 
<span class="lineNum">     799 </span><span class="lineCov">      24778 : Bool EQName::isEmpty() const</span>
<span class="lineNum">     800 </span>            : {
<span class="lineNum">     801 </span><span class="lineCov">      70856 :     return prefix.isEmpty() &amp;&amp; uri.isEmpty() &amp;&amp; local.isEmpty();</span>
<a name="802"><span class="lineNum">     802 </span>            : }</a>
<span class="lineNum">     803 </span>            : 
<span class="lineNum">     804 </span><span class="lineCov">      17169 : void EQName::empty()</span>
<span class="lineNum">     805 </span>            : {
<span class="lineNum">     806 </span><span class="lineCov">      17169 :     prefix.empty();</span>
<span class="lineNum">     807 </span><span class="lineCov">      17169 :     uri.empty();</span>
<span class="lineNum">     808 </span><span class="lineCov">      17169 :     local.empty();          </span>
<span class="lineNum">     809 </span><span class="lineCov">      17169 : }</span>
<span class="lineNum">     810 </span>            : 
<span class="lineNum">     811 </span><span class="lineNoCov">          0 : void EQName::set(const QName&amp; q, const HashTable&amp; dict)</span>
<span class="lineNum">     812 </span>            : {
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :     prefix = dict.getKey(q.getPrefix());</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :     uri = dict.getKey(q.getUri());</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :     local = dict.getKey(q.getLocal());</span>
<a name="816"><span class="lineNum">     816 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     817 </span>            : 
<span class="lineNum">     818 </span><span class="lineCov">      39472 : void EQName::setPrefix(const Str&amp; prefix_)</span>
<span class="lineNum">     819 </span>            : {
<span class="lineNum">     820 </span><span class="lineCov">      39472 :     prefix = prefix_;</span>
<a name="821"><span class="lineNum">     821 </span><span class="lineCov">      39472 : }</span></a>
<span class="lineNum">     822 </span>            : 
<span class="lineNum">     823 </span><span class="lineCov">      40283 : void EQName::setLocal(const Str&amp; local_)</span>
<span class="lineNum">     824 </span>            : {
<span class="lineNum">     825 </span><span class="lineCov">      40283 :     local = local_;</span>
<a name="826"><span class="lineNum">     826 </span><span class="lineCov">      40283 : }</span></a>
<span class="lineNum">     827 </span>            : 
<span class="lineNum">     828 </span><span class="lineCov">      39472 : void EQName::setUri(const Str&amp; uri_)</span>
<span class="lineNum">     829 </span>            : {
<span class="lineNum">     830 </span><span class="lineCov">      39472 :     uri = uri_;</span>
<span class="lineNum">     831 </span><span class="lineCov">      39472 : }</span>
<span class="lineNum">     832 </span>            : 
<span class="lineNum">     833 </span><span class="lineCov">      67161 : void EQName::getname(Str&amp; fullName) const</span>
<span class="lineNum">     834 </span>            : {
<span class="lineNum">     835 </span>            :     DStr strg;
<span class="lineNum">     836 </span><span class="lineCov">     134322 :     if (!prefix.isEmpty())</span>
<span class="lineNum">     837 </span>            :     {
<span class="lineNum">     838 </span><span class="lineCov">      23173 :         strg += prefix;</span>
<span class="lineNum">     839 </span><span class="lineCov">      23173 :         strg += &quot;:&quot;;</span>
<span class="lineNum">     840 </span>            :     };
<span class="lineNum">     841 </span><span class="lineCov">      67161 :     strg += local;</span>
<span class="lineNum">     842 </span><span class="lineCov">      67161 :     fullName = strg;</span>
<a name="843"><span class="lineNum">     843 </span><span class="lineCov">      67161 : }</span></a>
<span class="lineNum">     844 </span>            : 
<span class="lineNum">     845 </span><span class="lineCov">       3383 : const Str&amp; EQName::getLocal() const</span>
<span class="lineNum">     846 </span>            : {
<span class="lineNum">     847 </span><span class="lineCov">       3383 :     return local;</span>
<a name="848"><span class="lineNum">     848 </span>            : }</a>
<span class="lineNum">     849 </span>            : 
<span class="lineNum">     850 </span><span class="lineCov">      38101 : const Str&amp; EQName::getUri() const</span>
<span class="lineNum">     851 </span>            : {
<span class="lineNum">     852 </span><span class="lineCov">      38101 :     return uri;</span>
<a name="853"><span class="lineNum">     853 </span>            : }</a>
<span class="lineNum">     854 </span>            : 
<span class="lineNum">     855 </span><span class="lineNoCov">          0 : const Str&amp; EQName::getPrefix() const</span>
<span class="lineNum">     856 </span>            : {
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :     return prefix;</span>
<span class="lineNum">     858 </span>            : }
<span class="lineNum">     859 </span>            : 
<span class="lineNum">     860 </span><span class="lineNoCov">          0 : Bool EQName::hasPrefix() const</span>
<span class="lineNum">     861 </span>            : {
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :     return !prefix.isEmpty();</span>
<a name="863"><span class="lineNum">     863 </span>            : }</a>
<span class="lineNum">     864 </span>            : 
<span class="lineNum">     865 </span><span class="lineCov">       5467 : Bool EQName::operator==(const EQName &amp;other) const</span>
<span class="lineNum">     866 </span>            : {
<span class="lineNum">     867 </span><span class="lineCov">       5467 :     return (uri == other.getUri() </span>
<span class="lineNum">     868 </span><span class="lineCov">       5429 :         &amp;&amp; local == other.getLocal() </span>
<span class="lineNum">     869 </span><span class="lineCov">       5467 :             &amp;&amp; uri == other.getUri());</span>
<span class="lineNum">     870 </span>            : }
<span class="lineNum">     871 </span>            : 
<span class="lineNum">     872 </span>            : 
<span class="lineNum">     873 </span>            : 
<span class="lineNum">     874 </span>            : //
<span class="lineNum">     875 </span>            : //
<span class="lineNum">     876 </span>            : //                  StrStrList
<span class="lineNum">     877 </span>            : //
<span class="lineNum">     878 </span>            : //
<span class="lineNum">     879 </span>            : 
<a name="880"><span class="lineNum">     880 </span>            : </a>
<span class="lineNum">     881 </span>            : 
<span class="lineNum">     882 </span><span class="lineCov">      15212 : int StrStrList::findNum(const Str &amp;key_) const</span>
<span class="lineNum">     883 </span>            : {
<span class="lineNum">     884 </span><span class="lineCov">      15212 :     int i, count = number();</span>
<span class="lineNum">     885 </span><span class="lineCov">      15212 :     for (i = 0; (i &lt; count) &amp;&amp; !(key_ == ((*this)[i] -&gt; key)); i++) {};</span>
<span class="lineNum">     886 </span><span class="lineCov">      15212 :     return (i &lt; count) ? i : -1;</span>
<a name="887"><span class="lineNum">     887 </span>            : }</a>
<span class="lineNum">     888 </span>            : 
<span class="lineNum">     889 </span><span class="lineCov">      15212 : Str* StrStrList::find(const Str &amp;_key) const</span>
<span class="lineNum">     890 </span>            : {
<span class="lineNum">     891 </span><span class="lineCov">      15212 :     int ndx = findNum(_key);</span>
<span class="lineNum">     892 </span><span class="lineCov">      15212 :     return (ndx != -1) ? &amp;((*this)[ndx] -&gt; value) : NULL;</span>
<span class="lineNum">     893 </span>            : }
<span class="lineNum">     894 </span>            : 
<span class="lineNum">     895 </span><span class="lineCov">      19616 : void StrStrList::appendConstruct(const Str &amp;key, const Str&amp; value)</span>
<span class="lineNum">     896 </span>            : {
<span class="lineNum">     897 </span><span class="lineCov">      39232 :     StrStr* newItem = new StrStr;</span>
<span class="lineNum">     898 </span><span class="lineCov">      19616 :     newItem -&gt; key  = key;</span>
<span class="lineNum">     899 </span><span class="lineCov">      19616 :     newItem -&gt; value = value;</span>
<span class="lineNum">     900 </span><span class="lineCov">      19616 :     append(newItem);</span>
<span class="lineNum">     901 </span><span class="lineCov">      19616 : }</span>
<span class="lineNum">     902 </span>            : 
<span class="lineNum">     903 </span>            : //
<span class="lineNum">     904 </span>            : //
<span class="lineNum">     905 </span>            : //                  NamespaceStack
<span class="lineNum">     906 </span>            : //
<a name="907"><span class="lineNum">     907 </span>            : //</a>
<span class="lineNum">     908 </span>            : 
<span class="lineNum">     909 </span><span class="lineCov">      68226 : int NamespaceStack::findNum(const Str &amp;prefix_) const</span>
<span class="lineNum">     910 </span>            : {
<span class="lineNum">     911 </span><span class="lineCov">     234353 :     int i, count = number();</span>
<span class="lineNum">     912 </span><span class="lineCov">     234353 :     for (i = count-1; (i &gt;= 0) &amp;&amp; !(prefix_ == ((*this)[i] -&gt; prefix)); i--) {};</span>
<span class="lineNum">     913 </span><span class="lineCov">      68226 :     return i;</span>
<a name="914"><span class="lineNum">     914 </span>            : }</a>
<span class="lineNum">     915 </span>            : 
<span class="lineNum">     916 </span><span class="lineNoCov">          0 : const Str* NamespaceStack::getUri(const Str &amp;_prefix) const</span>
<span class="lineNum">     917 </span>            : {
<span class="lineNum">     918 </span><span class="lineNoCov">          0 :     int ndx = findNum(_prefix);</span>
<span class="lineNum">     919 </span><span class="lineNoCov">          0 :     return (ndx != -1) ? &amp;((*this)[ndx] -&gt; uri) : NULL;</span>
<span class="lineNum">     920 </span>            : }
<a name="921"><span class="lineNum">     921 </span>            : </a>
<span class="lineNum">     922 </span>            : 
<span class="lineNum">     923 </span><span class="lineNoCov">          0 : Bool NamespaceStack::isHidden(const Str &amp;_prefix) const</span>
<span class="lineNum">     924 </span>            : {
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :     int ndx = findNum(_prefix);</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :     return (ndx != -1) ? ((*this)[ndx] -&gt; hidden) : TRUE;</span>
<span class="lineNum">     927 </span>            : }
<span class="lineNum">     928 </span>            : 
<span class="lineNum">     929 </span><span class="lineCov">       2621 : void NamespaceStack::appendConstruct(const Str &amp;prefix, const Str&amp; uri,</span>
<span class="lineNum">     930 </span>            :                                      Bool _hidden)
<span class="lineNum">     931 </span>            : {
<span class="lineNum">     932 </span><span class="lineCov">       5242 :     NamespaceStackObj* newItem = new NamespaceStackObj;</span>
<span class="lineNum">     933 </span><span class="lineCov">       2621 :     newItem -&gt; prefix  = prefix;</span>
<span class="lineNum">     934 </span><span class="lineCov">       2621 :     newItem -&gt; uri = uri;</span>
<span class="lineNum">     935 </span><span class="lineCov">       2621 :     newItem -&gt; hidden = _hidden;</span>
<span class="lineNum">     936 </span><span class="lineCov">       2621 :     append(newItem);</span>
<span class="lineNum">     937 </span><span class="lineCov">       2621 : }</span>
<span class="lineNum">     938 </span>            : 
<span class="lineNum">     939 </span>            : 
<span class="lineNum">     940 </span>            : //
<span class="lineNum">     941 </span>            : //
<span class="lineNum">     942 </span>            : //                  EQNameList
<span class="lineNum">     943 </span>            : //
<span class="lineNum">     944 </span>            : //
<a name="945"><span class="lineNum">     945 </span>            : </a>
<span class="lineNum">     946 </span>            : 
<span class="lineNum">     947 </span><span class="lineCov">      18221 : const EQName* EQNameList::find(const EQName &amp;what) const</span>
<span class="lineNum">     948 </span>            : {
<span class="lineNum">     949 </span><span class="lineCov">      18221 :     int i, count = number();</span>
<span class="lineNum">     950 </span><span class="lineCov">      18221 :     for (i = 0; (i &lt; count) &amp;&amp; !(what == (*operator[](i))); i++) {};</span>
<span class="lineNum">     951 </span><span class="lineCov">      18221 :     return (i &lt; count) ? operator[](i) : NULL;</span>
<span class="lineNum">     952 </span>            : }
<span class="lineNum">     953 </span>            : 
<span class="lineNum">     954 </span>            : 
<span class="lineNum">     955 </span>            : 
<span class="lineNum">     956 </span>            : //
<span class="lineNum">     957 </span>            : //
<span class="lineNum">     958 </span>            : //                  EQNameStrList
<span class="lineNum">     959 </span>            : //
<span class="lineNum">     960 </span>            : //
<a name="961"><span class="lineNum">     961 </span>            : </a>
<span class="lineNum">     962 </span>            : // returns -1 if the EQName was not found
<span class="lineNum">     963 </span><span class="lineCov">      19768 : int EQNameStrList::findNdx(const EQName &amp;what) const</span>
<span class="lineNum">     964 </span>            : {
<span class="lineNum">     965 </span><span class="lineCov">      25235 :     int i, count = number();</span>
<span class="lineNum">     966 </span><span class="lineCov">      25235 :     for (i = 0; i &lt; count &amp;&amp; !(what == operator[](i) -&gt; key); i++) {};</span>
<span class="lineNum">     967 </span><span class="lineCov">      19768 :     return (i &lt; count) ? i : -1;</span>
<a name="968"><span class="lineNum">     968 </span>            : }</a>
<span class="lineNum">     969 </span>            : 
<span class="lineNum">     970 </span><span class="lineNoCov">          0 : const Str* EQNameStrList::find(const EQName &amp;what) const</span>
<span class="lineNum">     971 </span>            : {
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :     int i = findNdx(what);</span>
<span class="lineNum">     973 </span><span class="lineNoCov">          0 :     return (i != -1 ? &amp;(operator[](i) -&gt; value) : NULL);</span>
<a name="974"><span class="lineNum">     974 </span>            : }</a>
<span class="lineNum">     975 </span>            : 
<span class="lineNum">     976 </span><span class="lineCov">      19768 : void EQNameStrList::appendConstruct(const EQName &amp;key, const Str&amp; value)</span>
<span class="lineNum">     977 </span>            : {
<span class="lineNum">     978 </span><span class="lineCov">      19768 :     EQNameStr* newItem = new EQNameStr(key, value);</span>
<span class="lineNum">     979 </span><span class="lineCov">      19768 :     append(newItem);</span>
<span class="lineNum">     980 </span><span class="lineCov">      19768 : }</span>
<span class="lineNum">     981 </span>            : 
<span class="lineNum">     982 </span>            : 
<span class="lineNum">     983 </span>            : 
<a name="984"><span class="lineNum">     984 </span>            : /************************************/</a>
<span class="lineNum">     985 </span>            : /* PrefixList */
<span class="lineNum">     986 </span><span class="lineCov">     350200 : int UriList::findNdx(Phrase what) {</span>
<span class="lineNum">     987 </span><span class="lineCov">    1811784 :   for (int i = 0; i &lt; number(); i++) {</span>
<span class="lineNum">     988 </span><span class="lineCov">    1584634 :     Phrase foo = (*this)[i];</span>
<span class="lineNum">     989 </span><span class="lineCov">     678742 :     if (foo == what) return i;</span>
<span class="lineNum">     990 </span>            :   }
<span class="lineNum">     991 </span>            :   return -1;
<a name="992"><span class="lineNum">     992 </span>            : }</a>
<span class="lineNum">     993 </span>            : 
<span class="lineNum">     994 </span><span class="lineCov">       6795 : void UriList::addUri(Phrase what) {</span>
<span class="lineNum">     995 </span><span class="lineCov">       6795 :   int i = findNdx(what);</span>
<span class="lineNum">     996 </span><span class="lineCov">       6795 :   if (i == -1) append(what);</span>
<span class="lineNum">     997 </span><span class="lineCov">       6795 : }</span>
<span class="lineNum">     998 </span>            : 
<span class="lineNum">     999 </span>            : /************************************/
<a name="1000"><span class="lineNum">    1000 </span>            : /* SortedStringList */</a>
<span class="lineNum">    1001 </span>            : 
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 : int SortedStringList::compare(int i, int j, void * data)</span>
<span class="lineNum">    1003 </span>            : {
<span class="lineNum">    1004 </span><span class="lineNoCov">          0 :   return ((*this)[i] -&gt; compare(*((*this)[j])));</span>
<span class="lineNum">    1005 </span>            : }
<a name="1006"><span class="lineNum">    1006 </span>            : </a>
<span class="lineNum">    1007 </span>            : 
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 : int SortedStringList::findIdx(Str &amp; val)</span>
<span class="lineNum">    1009 </span>            : {
<span class="lineNum">    1010 </span>            :   int i, j, cmp, result;
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :   i = 0; </span>
<span class="lineNum">    1012 </span><span class="lineNoCov">          0 :   j = nItems - 1;</span>
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 :   result = -1;</span>
<span class="lineNum">    1014 </span>            : 
<span class="lineNum">    1015 </span><span class="lineNoCov">          0 :   while (i &lt;= j) {</span>
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :     int x = (int)((i + j) / 2);</span>
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :     cmp = (*this)[x] -&gt; compare(val);</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :     if (cmp &lt; 0) {</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :       i = x + 1;</span>
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :     } else if (cmp &gt; 0) {</span>
<span class="lineNum">    1021 </span><span class="lineNoCov">          0 :       j = x - 1;</span>
<span class="lineNum">    1022 </span>            :     } else {
<span class="lineNum">    1023 </span>            :       result = x;
<span class="lineNum">    1024 </span>            :       break;
<span class="lineNum">    1025 </span>            :     }
<span class="lineNum">    1026 </span>            :   }
<span class="lineNum">    1027 </span>            : 
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 :   return result;</span>
<span class="lineNum">    1029 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
